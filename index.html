
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc RxJS Tr·ª±c Quan - T·ª´ Ng∆∞·ªùi M·ªõi ƒê·∫øn Chuy√™n Gia</title>
    <script src="https://cdn.tailwindcss.com "></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/7.8.1/rxjs.umd.min.js "></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400 ;500;600;700&display=swap" rel="stylesheet">
    <!-- Highlight.js for code snippets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --secondary: #4b5563;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
        }
        
        html {
            scroll-behavior: smooth;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(-45deg, #e2e8f0, #f0f4f8, #cae1ff, #d6f0ff);
            background-size: 400% 400%;
            animation: bg-animation 15s ease infinite;
            color: #1f2937;
        }

        #scroll-progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(to right, #3b82f6, #60a5fa);
            width: 0%;
            z-index: 9999;
            transition: width 0.1s linear;
        }

        @keyframes bg-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .header-bg {
            background: linear-gradient(to right, #1e3a8a, #3b82f6);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .marble {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 40px; 
            height: 40px;
            padding: 0 8px; 
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            margin: 5px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0.5);
            font-size: 0.8rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            animation: marble-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes marble-appear {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .marble.error { 
            background-color: #e74c3c; 
            font-size: 1.2rem;
            animation: marble-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards, 
                       marble-error-shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
            animation-delay: 0s, 0.5s;
        }

        @keyframes marble-error-shake {
            10%, 90% { transform: scale(1) translate3d(-1px, 0, 0); }
            20%, 80% { transform: scale(1) translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: scale(1) translate3d(-4px, 0, 0); }
            40%, 60% { transform: scale(1) translate3d(4px, 0, 0); }
        }
        
        .marble.fallback { background-color: #f39c12; }

        .marble.complete { 
            background-color: #7f8c8d;
            min-width: 2px;
            width: 2px;
            height: 30px;
            border-radius: 2px;
            margin-top: 10px;
            padding: 0;
            transform: scaleY(0);
            transform-origin: center;
            animation: complete-line-draw 0.5s ease-out forwards;
        }

        @keyframes complete-line-draw {
            to {
                opacity: 1;
                transform: scaleY(1);
            }
        }
        
        .marble.subject-s1 { background-color: #9b59b6; } 
        .marble.subject-s2 { background-color: #e67e22; } 
        .marble.loading { background-color: #f1c40f; color: #333; animation: pulse 1.5s infinite; }
        .marble.api1 { background-color: #16a085; } 
        .marble.api2 { background-color: #27ae60; } 
        
        .marble-timeline {
            position: relative;
            padding: 15px 0;
            min-height: 70px;
        }
        
        .marble-timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #cbd5e1;
            transform: translateY(-50%);
            z-index: 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .operator-box, .subject-box, .example-box-interactive {
            min-height: 60px;
            border: 2px dashed #2ecc71;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            background-color: #f0fff4;
            position: relative;
            z-index: 1;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .operator-box::before, .subject-box::before {
            content: attr(data-label);
            position: absolute;
            top: -10px;
            left: 10px;
            background: white;
            padding: 0 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #4b5563;
        }
        
        .subject-box { 
            border-color: #3498db; 
            background-color: #eaf5ff; 
        }
        
        .example-box-interactive { 
            border-color: #e67e22; 
            background-color: #fff8f0; 
        }

        .nav-button {
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            background-color: #e5e7eb;
            color: #4b5563;
            border: 1px solid #d1d5db;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .nav-button:hover {
            background-color: #d1d5db;
            transform: translateY(-2px);
        }
        
        .nav-button.active {
            background-color: #2563eb; 
            color: white;
            border-color: #2563eb;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
        }
        
        .content-section {
            display: none; 
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-section.active {
            display: block; 
        }
        
        .btn {
            background-color: #3b82f6; 
            color: white;
            padding: 10px 15px; 
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 8px; 
            margin-bottom: 8px; 
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
        
        .btn:hover {
            background-color: #2563eb; 
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }
        
        .btn-secondary {
            background-color: #6b7280; 
        }
        
        .btn-secondary:hover {
            background-color: #4b5563; 
        }
        
        .btn-success {
             background-color: #22c55e; 
        }
        
        .btn-success:hover {
            background-color: #16a34a; 
        }
        
        .btn-warning {
            background-color: #f59e0b; 
        }
        
        .btn-warning:hover {
            background-color: #d97706; 
        }
        
        .btn-danger {
            background-color: #ef4444; 
        }
        
        .btn-danger:hover {
            background-color: #dc2626; 
        }
        
        .input-field {
            border: 1px solid #d1d5db; 
            padding: 10px 12px;
            border-radius: 8px;
            width: 100%;
            margin-top: 5px;
            margin-bottom: 15px; 
            font-size: 0.95rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .input-field.is-valid {
            border-color: #22c55e;
        }
        .input-field.is-valid:focus {
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
        }
        .input-field.is-invalid {
            border-color: #ef4444;
        }
        .input-field.is-invalid:focus {
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        .validation-message {
            font-size: 0.8rem;
            margin-top: -10px;
            margin-bottom: 10px;
            min-height: 1.2rem;
        }
        .validation-message.is-valid {
            color: #16a34a;
        }
        .validation-message.is-invalid {
            color: #dc2626;
        }
        
        .input-field-sm {
            width: auto;
            display: inline-block;
            margin-right: 10px;
        }
        
        .draggable {
            width: 100px; 
            height: 100px; 
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px; 
            cursor: grab; 
            position: absolute; 
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: 600;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .draggable.dragging { 
            cursor: grabbing; 
            background: linear-gradient(135deg, #ea580c, #c2410c);
            transform: scale(1.05);
            z-index: 1000;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        #dropZone {
            width: 100%; 
            height: 150px; 
            background-color: #ecf0f1; 
            border: 2px dashed #bdc3c7;
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px; 
            margin-top: 15px; 
            color: #7f8c8d; 
            font-style: italic;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        #dropZone.over { 
            background-color: #d1e7dd; 
            border-color: #22c55e; 
            color: #166534;
            animation: pulse-glow 1.5s infinite;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        #infiniteScrollContainer {
            height: 300px; 
            overflow-y: auto; 
            border: 1px solid #d1d5db; 
            padding: 10px; 
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        #infiniteScrollContainer .item {
            padding: 12px; 
            border-bottom: 1px solid #e5e7eb; 
            background-color: white; 
            margin-bottom: 8px; 
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        #infiniteScrollContainer .loading-more {
            text-align: center; 
            padding: 15px; 
            font-style: italic; 
            color: #6b7280;
        }
        
        .section-title {
            position: relative;
            padding-left: 24px;
            margin-bottom: 24px;
        }
        
        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: #2563eb;
            border-radius: 50%;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 100%;
            background-color: #d1d5db;
            z-index: -1;
        }
        
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
            border-left: 4px solid #2563eb;
        }
        
        .info-card h3 {
            margin-top: 0;
            color: #1e40af;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .timeline-container {
            position: relative;
            padding-left: 30px;
            margin-bottom: 30px;
        }
        
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #d1d5db;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #2563eb;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #2563eb;
        }
        
        .timeline-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .history-highlight {
            background: linear-gradient(120deg, #f0f9ff, #dbeafe);
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }
        
        .concept-diagram {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .analogy-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .analogy-title {
            color: #1e40af;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .interactive-demo {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px; /* Use margin-bottom instead of margin */
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .interactive-demo:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .visualization {
            min-height: 150px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }
        
        .conclusion-box {
            background: linear-gradient(135deg, #dbeafe, #eff6ff);
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            border-left: 4px solid #2563eb;
        }

        .demo-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }

        /* --- New styles for added features --- */
        .code-block-wrapper {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease-in-out;
        }
        .code-block-wrapper.show {
            opacity: 1;
            max-height: 1000px; /* Large enough to not clip content */
            margin-top: 1rem;
        }
        .copy-code-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: #4b5563;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        .copy-code-btn:hover {
            opacity: 1;
        }
        .copy-code-btn.copied {
            background-color: #22c55e;
            opacity: 1;
        }
        .use-case-box {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .use-case-box strong {
            color: #1e40af;
        }
        
        @media (max-width: 768px) {
            .nav-button {
                padding: 6px 12px;
                font-size: 0.85rem;
                margin-bottom: 8px;
            }
            
            .container {
                padding: 15px;
            }
            
            .marble {
                min-width: 35px;
                height: 35px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="scroll-progress-bar"></div>
    <div id="confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10000;"></div>

    <div class="container mx-auto max-w-5xl bg-white p-6 md:p-8 rounded-xl shadow-xl">
        <header class="mb-8 text-center header-bg py-8 px-4">
            <div class="max-w-2xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-4">H·ªçc RxJS Tr·ª±c Quan</h1>
                <p class="text-lg md:text-xl opacity-90">T·ª´ ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu ƒë·∫øn chuy√™n gia l·∫≠p tr√¨nh ph·∫£n ·ª©ng</p>
                <div class="mt-6">
                    <div class="inline-flex bg-white bg-opacity-20 backdrop-blur-sm rounded-full px-4 py-2 text-sm">
                        <span class="mr-2">‚≠ê</span> Kh√≥a h·ªçc tr·ª±c quan nh·∫•t v·ªÅ Reactive Programming
                    </div>
                </div>
            </div>
        </header>

        <!-- Search Input -->
        <div class="mb-8 px-1">
            <input type="search" id="searchInput" placeholder="üîé T√¨m ki·∫øm operator ho·∫∑c v√≠ d·ª•... (vd: switchMap, form, k√©o th·∫£)" class="w-full p-3 text-lg rounded-lg border-2 border-gray-300 focus:border-blue-500 focus:ring-blue-500 transition-all duration-300 shadow-sm hover:shadow-md focus:shadow-lg">
        </div>

        <nav class="flex flex-wrap justify-center gap-2 mb-8">
            <button data-section="intro" class="nav-button active">T·ªïng Quan</button>
            <button data-section="basic-operators" class="nav-button">Operators C∆° B·∫£n</button>
            <button data-section="advanced-operators" class="nav-button">Operators N√¢ng Cao</button>
            <button data-section="more-advanced-operators" class="nav-button">Operators K·∫øt H·ª£p</button>
            <button data-section="utility-operators" class="nav-button">Utility Operators</button>
            <button data-section="useful-operators" class="nav-button">Operators H·ªØu √çch</button>
            <button data-section="subjects" class="nav-button">Subjects</button>
            <button data-section="real-world" class="nav-button">V√≠ D·ª• Th·ª±c T·∫ø</button>
            <button data-section="hardcore-examples" class="nav-button">V√≠ D·ª• Kh√≥</button>
            <button data-section="ultra-hardcore-examples" class="nav-button">V√≠ D·ª• Si√™u Kh√≥</button>
        </nav>

        <main id="app-content">
            <!-- Section 1: Introduction -->
            <section id="intro" class="content-section active">
                 <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">1. Ch√†o m·ª´ng ƒë·∫øn v·ªõi RxJS</h2>
                 <div class="info-card">
                    <h3>RxJS l√† g√¨?</h3>
                    <p>RxJS (Reactive Extensions for JavaScript) l√† m·ªôt th∆∞ vi·ªán gi√∫p l·∫≠p tr√¨nh v·ªõi c√°c lu·ªìng d·ªØ li·ªáu b·∫•t ƒë·ªìng b·ªô. H√£y t∆∞·ªüng t∆∞·ª£ng b·∫°n ƒëang x·ª≠ l√Ω m·ªçi th·ª©, t·ª´ s·ª± ki·ªán click chu·ªôt, nh·∫≠p li·ªáu, ƒë·∫øn d·ªØ li·ªáu t·ª´ API, nh∆∞ nh·ªØng d√≤ng s√¥ng (streams) ch·∫£y li√™n t·ª•c. RxJS cung c·∫•p cho b·∫°n c√°c c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ ƒëi·ªÅu khi·ªÉn, bi·∫øn ƒë·ªïi v√† k·∫øt h·ª£p nh·ªØng d√≤ng s√¥ng n√†y.</p>
                </div>
                <div class="analogy-box">
                    <p class="analogy-title">üí° Ph√©p so s√°nh: D√¢y chuy·ªÅn s·∫£n xu·∫•t</p>
                    <p>H√£y xem m·ªôt <strong>Observable</strong> nh∆∞ m·ªôt d√¢y chuy·ªÅn s·∫£n xu·∫•t. N√≥ ƒë∆∞a ra c√°c "s·∫£n ph·∫©m th√¥" (d·ªØ li·ªáu). C√°c <strong>Operators</strong> (nh∆∞ <code>map</code>, <code>filter</code>) l√† c√°c c·ªó m√°y tr√™n d√¢y chuy·ªÅn, m·ªói m√°y th·ª±c hi·ªán m·ªôt c√¥ng ƒëo·∫°n x·ª≠ l√Ω. Cu·ªëi c√πng, <strong>Observer</strong> (ng∆∞·ªùi ƒëƒÉng k√Ω) l√† ng∆∞·ªùi nh·∫≠n "th√†nh ph·∫©m" (d·ªØ li·ªáu ƒë√£ qua x·ª≠ l√Ω).</p>
                </div>
                <div class="interactive-demo" data-demo-id="firstObservable" data-search-terms="of, observable, c∆° b·∫£n">
                    <h3 class="font-semibold text-lg mb-3">Observable ƒë·∫ßu ti√™n c·ªßa b·∫°n</h3>
                    <p class="mb-4">ƒê√¢y l√† m·ªôt Observable ƒë∆°n gi·∫£n nh·∫•t, s·ª≠ d·ª•ng h√†m <code>of</code> ƒë·ªÉ t·∫°o ra m·ªôt lu·ªìng d·ªØ li·ªáu ph√°t ra m·ªôt v√†i gi√° tr·ªã r·ªìi k·∫øt th√∫c.</p>
                    <div class="demo-controls">
                        <button id="runFirstObservable" class="btn">Ch·∫°y of('A', 'B', 'C')</button>
                        <button id="resetFirstObservable" class="btn btn-secondary btn-sm">Reset</button>
                    </div>
                    <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Lu·ªìng d·ªØ li·ªáu (Source):</div>
                    <div id="firstObservableStream" class="marble-timeline"></div>
                    <div class="text-sm text-gray-600 mb-2 font-medium mt-4">K·∫øt qu·∫£ nh·∫≠n ƒë∆∞·ª£c (Observer):</div>
                    <div id="firstObserverOutput" class="bg-gray-50 p-4 rounded-lg min-h-[80px]"></div>
                    <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                    <div class="code-block-wrapper">
                        <div class="relative">
                            <pre><code class="language-javascript" data-code-id="firstObservable"></code></pre>
                            <button class="btn btn-sm copy-code-btn">Copy</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Basic Operators -->
            <section id="basic-operators" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">2. C√°c Operators C∆° B·∫£n</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Map -->
                    <div class="interactive-demo" data-demo-id="map" data-search-terms="map, bi·∫øn ƒë·ªïi">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-purple-600">map(fn)</code> - Bi·∫øn ƒë·ªïi</h3>
                        <p class="mb-4">Bi·∫øn ƒë·ªïi m·ªói gi√° tr·ªã ƒë∆∞·ª£c ph√°t ra b·ªüi lu·ªìng ngu·ªìn. V√≠ d·ª•: nh√¢n m·ªói s·ªë v·ªõi 10.</p>
                        <div class="demo-controls">
                            <button id="runMapOperator" class="btn">Ch·∫°y Map</button>
                            <button id="resetMapOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (1,2,3 m·ªói 0.5s):</div>
                        <div id="mapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: map(x => x * 10)">x * 10</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="mapOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="map"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- Filter -->
                    <div class="interactive-demo" data-demo-id="filter" data-search-terms="filter, l·ªçc">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-blue-600">filter(fn)</code> - L·ªçc</h3>
                        <p class="mb-4">Ch·ªâ cho ph√©p c√°c gi√° tr·ªã th·ªèa m√£n m·ªôt ƒëi·ªÅu ki·ªán ƒëi qua. V√≠ d·ª•: ch·ªâ l·∫•y c√°c s·ªë ch·∫µn.</p>
                        <div class="demo-controls">
                            <button id="runFilterOperator" class="btn">Ch·∫°y Filter</button>
                            <button id="resetFilterOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (1..5 m·ªói 0.5s):</div>
                        <div id="filterInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: filter(x => x % 2 === 0)">x % 2 === 0</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="filterOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="filter"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                     <!-- Tap -->
                    <div class="interactive-demo" data-demo-id="tap" data-search-terms="tap, side effect, log, h√†nh ƒë·ªông ph·ª•">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-green-600">tap(fn)</code> - H√†nh ƒë·ªông ph·ª•</h3>
                        <p class="mb-4">Th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông ph·ª• (v√≠ d·ª•: logging) v·ªõi m·ªói gi√° tr·ªã m√† kh√¥ng l√†m thay ƒë·ªïi lu·ªìng.</p>
                        <div class="demo-controls">
                            <button id="runTapOperator" class="btn">Ch·∫°y Tap</button>
                            <button id="resetTapOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (A,B,C m·ªói 0.5s):</div>
                        <div id="tapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: tap(x => console.log(x))">LOG</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="tapOutputStream" class="marble-timeline"></div>
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log t·ª´ tap:</div>
                        <div id="tapLoggerOutput" class="bg-gray-50 p-4 rounded-lg min-h-[80px]"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="tap"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- Scan -->
                    <div class="interactive-demo" data-demo-id="scan" data-search-terms="scan, t√≠ch l≈©y, reduce">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-orange-600">scan(fn, seed)</code> - T√≠ch l≈©y</h3>
                        <p class="mb-4">T√≠ch l≈©y gi√° tr·ªã theo th·ªùi gian, t∆∞∆°ng t·ª± <code>reduce</code> c·ªßa Array nh∆∞ng ph√°t ra m·ªói gi√° tr·ªã trung gian.</p>
                        <div class="demo-controls">
                            <button id="runScanOperator" class="btn">Ch·∫°y Scan</button>
                             <button id="resetScanOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (1,2,3,4 m·ªói 0.5s):</div>
                        <div id="scanInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: scan((acc, curr) => acc + curr, 0)">T√çNH T·ªîNG</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="scanOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="scan"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Advanced Operators -->
            <section id="advanced-operators" class="content-section">
                 <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">3. Operators Chuy·ªÉn ƒê·ªïi (Flattening)</h2>
                 <p class="mb-4 info-card">C√°c operators n√†y x·ª≠ l√Ω "Observable c·ªßa Observable" (lu·ªìng l·ªìng trong lu·ªìng). T√¨nh hu·ªëng ph·ªï bi·∫øn l√† khi m·ªôt s·ª± ki·ªán (nh∆∞ click) k√≠ch ho·∫°t m·ªôt t√°c v·ª• b·∫•t ƒë·ªìng b·ªô kh√°c (nh∆∞ g·ªçi API).</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- mergeMap -->
                    <div class="interactive-demo" data-demo-id="mergeMap" data-search-terms="mergeMap, flatMap, song song">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-red-600">mergeMap</code> - H·ª£p nh·∫•t lu·ªìng</h3>
                        <p class="mb-4">T·∫°o v√† ƒëƒÉng k√Ω v√†o m·ªôt lu·ªìng con cho m·ªói gi√° tr·ªã t·ª´ lu·ªìng cha. T·∫•t c·∫£ c√°c lu·ªìng con ch·∫°y song song v√† k·∫øt qu·∫£ ƒë∆∞·ª£c h·ª£p nh·∫•t.</p>
                         <div class="demo-controls">
                            <button id="runMergeMap" class="btn">Click ƒë·ªÉ ph√°t lu·ªìng con</button>
                             <button id="resetMergeMap" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                        <div id="mergeMapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: mergeMap">T·∫°o & H·ª£p nh·∫•t lu·ªìng con</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="mergeMapOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="use-case-box"><strong>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:</strong> Khi b·∫°n c·∫ßn th·ª±c hi·ªán nhi·ªÅu t√°c v·ª• b·∫•t ƒë·ªìng b·ªô song song v√† kh√¥ng quan t√¢m ƒë·∫øn th·ª© t·ª± ho√†n th√†nh c·ªßa ch√∫ng (v√≠ d·ª•: t·∫£i nhi·ªÅu ·∫£nh c√πng l√∫c).</div>
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="flattening"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- switchMap -->
                    <div class="interactive-demo" data-demo-id="switchMap" data-search-terms="switchMap, h·ªßy, chuy·ªÉn, t√¨m ki·∫øm">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-yellow-600">switchMap</code> - Chuy·ªÉn lu·ªìng</h3>
                        <p class="mb-4">Gi·ªëng <code>mergeMap</code>, nh∆∞ng khi lu·ªìng cha ph√°t gi√° tr·ªã m·ªõi, n√≥ s·∫Ω h·ªßy lu·ªìng con tr∆∞·ªõc ƒë√≥ v√† chuy·ªÉn sang lu·ªìng con m·ªõi.</p>
                        <div class="demo-controls">
                            <button id="runSwitchMap" class="btn">Click ƒë·ªÉ chuy·ªÉn lu·ªìng</button>
                            <button id="resetSwitchMap" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                        <div id="switchMapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: switchMap">H·ªßy lu·ªìng c≈© & Chuy·ªÉn lu·ªìng m·ªõi</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="switchMapOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                           <div class="use-case-box"><strong>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:</strong> C·ª±c k·ª≥ h·ªØu √≠ch cho c√°c t√≠nh nƒÉng nh∆∞ g·ª£i √Ω t√¨m ki·∫øm (typeahead), khi b·∫°n ch·ªâ quan t√¢m ƒë·∫øn k·∫øt qu·∫£ c·ªßa l·∫ßn g√µ cu·ªëi c√πng v√† mu·ªën h·ªßy c√°c y√™u c·∫ßu API c≈©.</div>
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="flattening"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                     <!-- concatMap -->
                    <div class="interactive-demo" data-demo-id="concatMap" data-search-terms="concatMap, n·ªëi, tu·∫ßn t·ª±, th·ª© t·ª±">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-green-600">concatMap</code> - N·ªëi lu·ªìng</h3>
                        <p class="mb-4">Ch·∫°y c√°c lu·ªìng con m·ªôt c√°ch tu·∫ßn t·ª±. Lu·ªìng con ti·∫øp theo ch·ªâ b·∫Øt ƒë·∫ßu khi lu·ªìng con tr∆∞·ªõc ƒë√≥ ƒë√£ ho√†n th√†nh. ƒê·∫£m b·∫£o th·ª© t·ª±.</p>
                         <div class="demo-controls">
                            <button id="runConcatMap" class="btn">Click ƒë·ªÉ x·∫øp h√†ng lu·ªìng</button>
                            <button id="resetConcatMap" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                        <div id="concatMapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: concatMap">X·∫øp h√†ng & Ch·∫°y tu·∫ßn t·ª±</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="concatMapOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="use-case-box"><strong>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:</strong> Khi th·ª© t·ª± th·ª±c hi·ªán l√† quan tr·ªçng. V√≠ d·ª•: m·ªôt chu·ªói c√°c y√™u c·∫ßu API ƒë·ªçc-ghi m√† y√™u c·∫ßu sau ph·ª• thu·ªôc v√†o k·∫øt qu·∫£ c·ªßa y√™u c·∫ßu tr∆∞·ªõc.</div>
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="flattening"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- exhaustMap -->
                    <div class="interactive-demo" data-demo-id="exhaustMap" data-search-terms="exhaustMap, b·ªè qua, spam, lock">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-blue-600">exhaustMap</code> - B·ªè qua lu·ªìng</h3>
                        <p class="mb-4">B·ªè qua c√°c gi√° tr·ªã m·ªõi t·ª´ lu·ªìng cha trong khi m·ªôt lu·ªìng con ƒëang ho·∫°t ƒë·ªông. H·ªØu √≠ch ƒë·ªÉ ch·ªëng click-spam.</p>
                         <div class="demo-controls">
                            <button id="runExhaustMap" class="btn">Click (th·ª≠ click nhanh)</button>
                            <button id="resetExhaustMap" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                        <div id="exhaustMapInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: exhaustMap">B·ªè qua click khi ƒëang b·∫≠n</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="exhaustMapOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="use-case-box"><strong>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng:</strong> Ho√†n h·∫£o cho c√°c n√∫t b·∫•m ch·ªâ n√™n ƒë∆∞·ª£c x·ª≠ l√Ω m·ªôt l·∫ßn, nh∆∞ n√∫t "Login" ho·∫∑c "Submit", ƒë·ªÉ ngƒÉn ng∆∞·ªùi d√πng g·ª≠i nhi·ªÅu y√™u c·∫ßu b·∫±ng c√°ch click li√™n t·ª•c.</div>
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="flattening"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section 4: Combination Operators -->
            <section id="more-advanced-operators" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">4. Operators K·∫øt H·ª£p (Combination)</h2>
                <p class="mb-4 info-card">C√°c operators n√†y cho ph√©p b·∫°n k·∫øt h·ª£p nhi·ªÅu lu·ªìng d·ªØ li·ªáu l·∫°i v·ªõi nhau theo nh·ªØng c√°ch kh√°c nhau.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- combineLatest -->
                    <div class="interactive-demo" data-demo-id="combineLatest" data-search-terms="combineLatest, k·∫øt h·ª£p, form validation">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-indigo-600">combineLatest</code> - K·∫øt h·ª£p gi√° tr·ªã m·ªõi nh·∫•t</h3>
                        <p class="mb-4">Khi b·∫•t k·ª≥ lu·ªìng n√†o ph√°t, n√≥ s·∫Ω ph√°t ra m·ªôt m·∫£ng ch·ª©a gi√° tr·ªã m·ªõi nh·∫•t t·ª´ T·∫§T C·∫¢ c√°c lu·ªìng. S·∫Ω kh√¥ng ph√°t g√¨ cho ƒë·∫øn khi m·ªçi lu·ªìng ƒë√£ ph√°t √≠t nh·∫•t m·ªôt l·∫ßn.</p>
                        <div class="demo-controls">
                           <button id="emitSourceACombine" class="btn btn-secondary">Ph√°t Stream A</button>
                           <button id="emitSourceBCombine" class="btn btn-secondary">Ph√°t Stream B</button>
                           <button id="resetCombine" class="btn btn-danger btn-sm">Reset</button>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>Stream A: <div id="combineSourceAStream" class="marble-timeline min-h-[50px]"></div></div>
                            <div>Stream B: <div id="combineSourceBStream" class="marble-timeline min-h-[50px]"></div></div>
                        </div>
                        <div class="operator-box" data-label="combineLatest([streamA, streamB])">K·∫øt h·ª£p</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="combineOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="combineLatest"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- forkJoin -->
                    <div class="interactive-demo" data-demo-id="forkJoin" data-search-terms="forkJoin, promise.all, ƒë·ªìng b·ªô, ch·ªù">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-teal-600">forkJoin</code> - Ch·ªù t·∫•t c·∫£ ho√†n th√†nh</h3>
                        <p class="mb-4">T∆∞∆°ng t·ª± <code>Promise.all</code>. Ch·ªù cho t·∫•t c·∫£ c√°c lu·ªìng ngu·ªìn ho√†n th√†nh, sau ƒë√≥ ph√°t ra m·ªôt m·∫£ng ch·ª©a gi√° tr·ªã CU·ªêI C√ôNG t·ª´ m·ªói lu·ªìng.</p>
                         <div class="demo-controls">
                            <button id="runForkJoin" class="btn">Ch·∫°y 2 API song song</button>
                             <button id="resetForkJoin" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>API 1 (1.5s): <div id="forkJoinSource1Stream" class="marble-timeline min-h-[50px]"></div></div>
                            <div>API 2 (2.5s): <div id="forkJoinSource2Stream" class="marble-timeline min-h-[50px]"></div></div>
                        </div>
                        <div class="operator-box" data-label="forkJoin({ api1, api2 })">Ch·ªù</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output (ch·ªâ khi c·∫£ 2 xong):</div>
                        <div id="forkJoinOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="forkJoin"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section NEW: Utility Operators -->
            <section id="utility-operators" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">5. Utility Operators</h2>
                 <p class="mb-4 info-card">ƒê√¢y l√† t·∫≠p h·ª£p c√°c to√°n t·ª≠ ti·ªán √≠ch m·∫°nh m·∫Ω ƒë·ªÉ ƒëi·ªÅu khi·ªÉn lu·ªìng d·ªØ li·ªáu, ƒë·∫∑c bi·ªát h·ªØu √≠ch trong vi·ªác x·ª≠ l√Ω t∆∞∆°ng t√°c ng∆∞·ªùi d√πng ho·∫∑c c√°c ngu·ªìn ph√°t d·ªØ li·ªáu d√†y ƒë·∫∑c.</p>
                <div class="grid grid-cols-1 gap-6">
                    <!-- DebounceTime vs ThrottleTime -->
                    <div class="interactive-demo col-span-1" data-demo-id="rateLimit" data-search-terms="debounceTime, throttleTime, so s√°nh">
                        <h3 class="font-semibold text-lg mb-3">So s√°nh <code class="text-purple-600">debounceTime</code> v√† <code class="text-blue-600">throttleTime</code></h3>
                        <p class="mb-4">Click v√†o n√∫t b√™n d∆∞·ªõi th·∫≠t nhanh v√† nhi·ªÅu l·∫ßn ƒë·ªÉ xem s·ª± kh√°c bi·ªát. <strong>Debounce</strong> ch·ªâ ph√°t gi√° tr·ªã sau khi c√≥ m·ªôt kho·∫£ng l·∫∑ng. <strong>Throttle</strong> ph√°t gi√° tr·ªã ƒë·∫ßu ti√™n, sau ƒë√≥ ch·∫∑n trong m·ªôt kho·∫£ng th·ªùi gian.</p>
                        <div class="demo-controls">
                            <button id="runRateLimit" class="btn btn-warning">CLICK V√ÄO T√îI!</button>
                             <button id="resetRateLimit" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                        <div id="rateLimitInputStream" class="marble-timeline"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <div class="operator-box" data-label="debounceTime(1000)">Debounce Output</div>
                                <div id="debounceOutputStream" class="marble-timeline"></div>
                            </div>
                             <div>
                                <div class="operator-box" data-label="throttleTime(1000)">Throttle Output</div>
                                <div id="throttleOutputStream" class="marble-timeline"></div>
                            </div>
                        </div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="rateLimit"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- bufferTime -->
                        <div class="interactive-demo" data-demo-id="bufferTime" data-search-terms="bufferTime, gom, b·ªô ƒë·ªám">
                            <h3 class="font-semibold text-lg mb-3"><code class="text-green-600">bufferTime(2000)</code></h3>
                            <p class="mb-4">Gom c√°c gi√° tr·ªã t·ª´ lu·ªìng ngu·ªìn v√†o m·ªôt b·ªô ƒë·ªám v√† ph√°t ra b·ªô ƒë·ªám n√†y sau m·ªói 2 gi√¢y.</p>
                            <div class="demo-controls">
                                <button id="runBufferTime" class="btn">Click ƒë·ªÉ ph√°t gi√° tr·ªã</button>
                                <button id="resetBufferTime" class="btn btn-secondary btn-sm">Reset</button>
                            </div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">Input (Clicks):</div>
                            <div id="bufferTimeInputStream" class="marble-timeline"></div>
                            <div class="operator-box" data-label="bufferTime(2000)">Gom m·ªói 2s</div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">Output (m·∫£ng gi√° tr·ªã):</div>
                            <div id="bufferTimeOutputStream" class="marble-timeline"></div>
                             <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                            <div class="code-block-wrapper">
                                <div class="relative">
                                    <pre><code class="language-javascript" data-code-id="bufferTime"></code></pre>
                                    <button class="btn btn-sm copy-code-btn">Copy</button>
                                </div>
                            </div>
                        </div>
                         <!-- pairwise -->
                        <div class="interactive-demo" data-demo-id="pairwise" data-search-terms="pairwise, c·∫∑p, tr∆∞·ªõc sau">
                            <h3 class="font-semibold text-lg mb-3"><code class="text-orange-600">pairwise()</code></h3>
                            <p class="mb-4">Nh√≥m c√°c gi√° tr·ªã li√™n ti·∫øp th√†nh t·ª´ng c·∫∑p `[tr∆∞·ªõc, sau]` v√† ph√°t ra.</p>
                             <div class="demo-controls">
                                <button id="runPairwise" class="btn">Ch·∫°y lu·ªìng s·ªë</button>
                                 <button id="resetPairwise" class="btn btn-secondary btn-sm">Reset</button>
                            </div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">Input (0,1,2,3...):</div>
                            <div id="pairwiseInputStream" class="marble-timeline"></div>
                            <div class="operator-box" data-label="pairwise()">Gh√©p c·∫∑p</div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">Output ([tr∆∞·ªõc, sau]):</div>
                            <div id="pairwiseOutputStream" class="marble-timeline"></div>
                             <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                            <div class="code-block-wrapper">
                                <div class="relative">
                                    <pre><code class="language-javascript" data-code-id="pairwise"></code></pre>
                                    <button class="btn btn-sm copy-code-btn">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                     <!-- withLatestFrom -->
                    <div class="interactive-demo" data-demo-id="withLatestFrom" data-search-terms="withLatestFrom, k·∫øt h·ª£p, gi√° tr·ªã cu·ªëi">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-indigo-600">withLatestFrom(other$)</code></h3>
                        <p class="mb-4">Khi lu·ªìng ch√≠nh (Clicks) ph√°t, n√≥ s·∫Ω k·∫øt h·ª£p gi√° tr·ªã c·ªßa m√¨nh v·ªõi gi√° tr·ªã **m·ªõi nh·∫•t** t·ª´ lu·ªìng ph·ª• (Timer). Lu·ªìng ph·ª• ch·∫°y ng·∫ßm.</p>
                         <div class="demo-controls">
                            <button id="runWithLatestFrom" class="btn">Click ƒë·ªÉ l·∫•y gi√° tr·ªã t·ª´ Timer</button>
                             <button id="resetWithLatestFrom" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Lu·ªìng ch√≠nh (Clicks):</div>
                                <div id="wlfSourceStream" class="marble-timeline"></div>
                            </div>
                             <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Lu·ªìng ph·ª• (Timer m·ªói 1.5s):</div>
                                <div id="wlfOtherStream" class="marble-timeline"></div>
                            </div>
                        </div>
                        <div class="operator-box" data-label="withLatestFrom(timer$)">K·∫øt h·ª£p</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output ([click, timer]):</div>
                        <div id="wlfOutputStream" class="marble-timeline"></div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="withLatestFrom"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Section 5: Useful Operators -->
            <section id="useful-operators" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">6. Operators H·ªØu √çch Kh√°c</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Take -->
                    <div class="interactive-demo" data-demo-id="take" data-search-terms="take, gi·ªõi h·∫°n, l·∫•y">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-green-600">take(count)</code> - Gi·ªõi H·∫°n S·ªë L∆∞·ª£ng</h3>
                        <p class="mb-4">Ch·ªâ l·∫•y m·ªôt s·ªë l∆∞·ª£ng gi√° tr·ªã x√°c ƒë·ªãnh t·ª´ lu·ªìng d·ªØ li·ªáu.</p>
                        <div class="demo-controls">
                            <button id="runTakeOperator" class="btn mb-2">Ch·∫°y Take</button>
                             <button id="resetTakeOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        
                        <label for="takeCountInput" class="text-sm font-medium text-gray-700 mr-2">S·ªë l∆∞·ª£ng l·∫•y:</label>
                        <input type="number" id="takeCountInput" value="3" class="input-field input-field-sm w-20 mb-4">
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (0,1,2,... m·ªói 0.5s):</div>
                        <div id="takeInputStream" class="marble-timeline"></div>
                        
                        <div class="operator-box" data-label="PIPE: TAKE">TAKE(<span id="takeCountDisplay">3</span>)</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="takeOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="take"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Zip -->
                    <div class="interactive-demo" data-demo-id="zip" data-search-terms="zip, gh√©p c·∫∑p, ƒë√¥i">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-orange-600">zip(obs1,...)</code> - Gh√©p C·∫∑p</h3>
                        <p class="mb-4">Gh√©p c·∫∑p c√°c gi√° tr·ªã t·ª´ nhi·ªÅu lu·ªìng theo th·ª© t·ª± xu·∫•t hi·ªán.</p>
                        
                        <div class="demo-controls">
                            <button id="emitSource1Zip" class="btn btn-secondary">Ph√°t Stream A</button>
                            <button id="emitSource2Zip" class="btn btn-secondary">Ph√°t Stream B</button>
                             <button id="resetZipOperator" class="btn btn-danger btn-sm">Reset</button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Stream A:</div>
                                <div id="zipSource1Stream" class="marble-timeline min-h-[50px]"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Stream B:</div>
                                <div id="zipSource2Stream" class="marble-timeline min-h-[50px]"></div>
                            </div>
                        </div>
                        
                        <div class="operator-box" data-label="ZIP">ZIP</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Output (Gh√©p c·∫∑p):</div>
                        <div id="zipOutputStream" class="marble-timeline"></div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                        <div id="zipLoggerOutput" class="bg-gray-50 p-4 rounded-lg min-h-[100px] font-mono text-sm"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="zip"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CatchError -->
                    <div class="interactive-demo" data-demo-id="catchError" data-search-terms="catchError, error, x·ª≠ l√Ω l·ªói, try catch">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-red-700">catchError(fn)</code> - X·ª≠ L√Ω L·ªói</h3>
                        <p class="mb-4">B·∫Øt v√† x·ª≠ l√Ω l·ªói trong lu·ªìng d·ªØ li·ªáu, tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã thay th·∫ø ho·∫∑c lu·ªìng m·ªõi.</p>
                        
                        <div class="demo-controls">
                            <button id="runCatchErrorStream" class="btn btn-danger">Ch·∫°y Stream (L·ªñI)</button>
                            <button id="runCatchErrorStreamNoError" class="btn btn-success">Ch·∫°y Stream (OK)</button>
                             <button id="resetCatchError" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Input (1,2, L·ªñI/3):</div>
                        <div id="catchErrorInputStream" class="marble-timeline"></div>
                        
                        <div class="operator-box" data-label="PIPE: CATCHERROR">CATCHERROR (tr·∫£ v·ªÅ 'ƒê√£ Fix')</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="catchErrorOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="catchError"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- StartWith -->
                    <div class="interactive-demo" data-demo-id="startWith" data-search-terms="startWith, b·∫Øt ƒë·∫ßu, gi√° tr·ªã kh·ªüi t·∫°o">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-blue-500">startWith(...values)</code> - B·∫Øt ƒê·∫ßu V·ªõi Gi√° Tr·ªã</h3>
                        <p class="mb-4">Th√™m c√°c gi√° tr·ªã v√†o ƒë·∫ßu lu·ªìng d·ªØ li·ªáu tr∆∞·ªõc khi lu·ªìng ch√≠nh b·∫Øt ƒë·∫ßu ph√°t gi√° tr·ªã.</p>
                        <div class="demo-controls">
                             <button id="runStartWithOperator" class="btn mb-4">Ch·∫°y StartWith</button>
                             <button id="resetStartWithOperator" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <input type="text" id="startWithValuesInput" value="-1,0" class="input-field mb-4" placeholder="Gi√° tr·ªã b·∫Øt ƒë·∫ßu, c√°ch nhau b·ªüi d·∫•u ph·∫©y, vd: -1,0,Hi">
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Stream g·ªëc (1,2,3 sau 1s):</div>
                        <div id="startWithInputStream" class="marble-timeline"></div>
                        
                        <div class="operator-box" data-label="PIPE: STARTWITH">STARTWITH(<span id="startWithValuesDisplay">-1,0</span>)</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Output:</div>
                        <div id="startWithOutputStream" class="marble-timeline"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="startWith"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Subjects -->
            <section id="subjects" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">7. Subjects - ƒêa H∆∞·ªõng D·ªØ Li·ªáu</h2>
                
                <div class="info-card">
                    <p>Subject l√† m·ªôt d·∫°ng ƒë·∫∑c bi·ªát c·ªßa Observable cho ph√©p ƒëa h∆∞·ªõng d·ªØ li·ªáu - nhi·ªÅu Observer c√≥ th·ªÉ subscribe v√†o c√πng m·ªôt Subject. Subject c≈©ng l√† m·ªôt Observer, c√≥ th·ªÉ nh·∫≠n d·ªØ li·ªáu th√¥ng qua c√°c ph∆∞∆°ng th·ª©c next(), error() v√† complete().</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Subject -->
                    <div class="interactive-demo" data-demo-id="subject" data-search-terms="Subject, multicast, ƒëa h∆∞·ªõng">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-purple-700">Subject</code></h3>
                        <p class="mb-4">Subject c∆° b·∫£n - Observer ch·ªâ nh·∫≠n c√°c gi√° tr·ªã ph√°t ra sau khi subscribe.</p>
                        
                        <div class="demo-controls">
                            <button id="runBasicSubject" class="btn btn-success">T·∫°o Subject & Sub1</button>
                            <button id="emitToBasicSubject" class="btn btn-warning">Ph√°t</button>
                            <button id="addBasicSubjectSub2" class="btn btn-info">Th√™m Sub2</button>
                            <button id="resetBasicSubject" class="btn btn-danger btn-sm">Reset</button>
                        </div>
                        
                        <div class="subject-box" data-label="SUBJECT">SUBJECT</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log Subject:</div>
                        <div id="basicSubjectLog" class="bg-gray-50 p-4 rounded-lg min-h-[80px] text-sm"></div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 1 nh·∫≠n:</div>
                                <div id="basicSubjectSub1Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 2 nh·∫≠n:</div>
                                <div id="basicSubjectSub2Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                        </div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="subject"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BehaviorSubject -->
                    <div class="interactive-demo" data-demo-id="behaviorSubject" data-search-terms="BehaviorSubject, state, tr·∫°ng th√°i">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-green-700">BehaviorSubject</code></h3>
                        <p class="mb-4">L∆∞u tr·ªØ gi√° tr·ªã hi·ªán t·∫°i v√† ph√°t n√≥ cho c√°c subscriber m·ªõi ngay khi h·ªç subscribe.</p>
                        
                         <div class="demo-controls">
                            <button id="runBehaviorSubject" class="btn btn-success">T·∫°o & Sub1</button>
                            <button id="emitToBehaviorSubject" class="btn btn-warning">Ph√°t</button>
                            <button id="addBehaviorSubjectSub2" class="btn btn-info">Th√™m Sub2</button>
                            <button id="resetBehaviorSubject" class="btn btn-danger btn-sm">Reset</button>
                        </div>
                        
                        <div class="subject-box" data-label="BEHAVIOR_SUBJECT">BEHAVIOR_SUBJECT (kh·ªüi t·∫°o v·ªõi 'Hi·∫øu')</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log BehaviorSubject:</div>
                        <div id="behaviorSubjectLog" class="bg-gray-50 p-4 rounded-lg min-h-[80px] text-sm"></div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 1 nh·∫≠n:</div>
                                <div id="behaviorSubjectSub1Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 2 nh·∫≠n:</div>
                                <div id="behaviorSubjectSub2Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                        </div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="behaviorSubject"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ReplaySubject -->
                    <div class="interactive-demo" data-demo-id="replaySubject" data-search-terms="ReplaySubject, cache, b·ªô ƒë·ªám, ph√°t l·∫°i">
                        <h3 class="font-semibold text-lg mb-3"><code class="text-blue-700">ReplaySubject</code></h3>
                        <p class="mb-4">L∆∞u tr·ªØ m·ªôt s·ªë l∆∞·ª£ng gi√° tr·ªã ƒë√£ ph√°t tr∆∞·ªõc ƒë√≥ v√† ph√°t l·∫°i cho c√°c subscriber m·ªõi.</p>
                        
                         <div class="demo-controls">
                            <button id="runReplaySubject" class="btn btn-success">T·∫°o & Sub1</button>
                            <button id="emitToReplaySubject" class="btn btn-warning">Ph√°t</button>
                            <button id="addReplaySubjectSub2" class="btn btn-info">Th√™m Sub2</button>
                            <button id="resetReplaySubject" class="btn btn-danger btn-sm">Reset</button>
                        </div>
                        
                        <div class="subject-box" data-label="REPLAY_SUBJECT">REPLAY_SUBJECT (nh·ªõ 2 gi√° tr·ªã)</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log ReplaySubject:</div>
                        <div id="replaySubjectLog" class="bg-gray-50 p-4 rounded-lg min-h-[80px] text-sm"></div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 1 nh·∫≠n:</div>
                                <div id="replaySubjectSub1Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2 font-medium">Subscriber 2 nh·∫≠n:</div>
                                <div id="replaySubjectSub2Output" class="marble-timeline min-h-[50px]"></div>
                            </div>
                        </div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="replaySubject"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 7: Real-World Examples -->
            <section id="real-world" class="content-section">
                 <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">8. V√≠ D·ª• Th·ª±c T·∫ø</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Simple Type Ahead -->
                    <div class="interactive-demo" data-demo-id="typeahead" data-search-terms="typeahead, g·ª£i √Ω t√¨m ki·∫øm, search, api">
                        <h3 class="font-semibold text-lg mb-3">8.1. G·ª£i √Ω t√¨m ki·∫øm (Typeahead)</h3>
                        <p class="mb-4">M·ªôt ·ª©ng d·ª•ng kinh ƒëi·ªÉn c·ªßa RxJS: ƒë·ª£i ng∆∞·ªùi d√πng ng·ª´ng g√µ, sau ƒë√≥ m·ªõi th·ª±c hi·ªán t√¨m ki·∫øm ƒë·ªÉ tr√°nh c√°c request kh√¥ng c·∫ßn thi·∫øt.</p>
                        <input type="text" id="typeaheadInput" placeholder="G√µ ƒë·ªÉ t√¨m ki·∫øm..." class="input-field mb-4">
                        <div class="text-sm text-gray-600 mb-2 font-medium">Stream g√µ ph√≠m:</div>
                        <div id="typeaheadInputStream" class="marble-timeline"></div>
                        <div class="operator-box" data-label="PIPE: debounceTime(400) -> distinctUntilChanged() -> switchMap(apiCall)">X·ª≠ l√Ω t√¨m ki·∫øm</div>
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">K·∫øt qu·∫£ t·ª´ API (gi·∫£):</div>
                        <div id="typeaheadResult" class="bg-gray-50 p-4 rounded-lg min-h-[80px]"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="typeahead"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    <!-- Progress Bar -->
                    <div class="interactive-demo" data-demo-id="progressBar" data-search-terms="progress bar, thanh ti·∫øn tr√¨nh, t·∫£i">
                        <h3 class="font-semibold text-lg mb-3">8.2. Thanh ti·∫øn tr√¨nh (Progress Bar)</h3>
                        <p class="mb-4">S·ª≠ d·ª•ng RxJS ƒë·ªÉ ƒëi·ªÅu khi·ªÉn m·ªôt thanh ti·∫øn tr√¨nh, r·∫•t h·ªØu √≠ch cho vi·ªác hi·ªÉn th·ªã tr·∫°ng th√°i t·∫£i file ho·∫∑c c√°c t√°c v·ª• k√©o d√†i.</p>
                        <div class="demo-controls">
                            <button id="startProgressBar" class="btn">B·∫Øt ƒë·∫ßu t·∫£i</button>
                            <button id="resetProgressBar" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div class="progress-bar mt-4">
                            <div id="progressFill" class="progress-fill"></div>
                        </div>
                        <div id="progressStatus" class="text-center font-semibold text-blue-700 mt-2"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="progressBar"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
                 <!-- Real-time Form Validation -->
                 <div class="interactive-demo col-span-1 md:col-span-2" data-demo-id="formValidation" data-search-terms="form, validation, x√°c th·ª±c, combineLatest">
                     <h3 class="font-semibold text-lg mb-3">8.3. X√°c th·ª±c bi·ªÉu m·∫´u (Real-time Form Validation)</h3>
                     <p class="mb-4">S·ª≠ d·ª•ng <code>combineLatest</code> ƒë·ªÉ t·ªïng h·ª£p tr·∫°ng th√°i h·ª£p l·ªá c·ªßa nhi·ªÅu tr∆∞·ªùng v√† ch·ªâ cho ph√©p g·ª≠i khi t·∫•t c·∫£ ƒë·ªÅu OK. T√™n ng∆∞·ªùi d√πng "admin" ho·∫∑c "root" s·∫Ω b·ªã b√°o l√† ƒë√£ t·ªìn t·∫°i (ki·ªÉm tra b·∫•t ƒë·ªìng b·ªô).</p>
                    <form id="validationForm">
                        <div>
                            <label for="usernameInput" class="font-medium">T√™n ng∆∞·ªùi d√πng</label>
                            <input type="text" id="usernameInput" class="input-field" placeholder="√çt nh·∫•t 3 k√Ω t·ª±, kh√¥ng ph·∫£i 'admin'">
                            <div id="usernameValidationMsg" class="validation-message"></div>
                        </div>
                         <div>
                            <label for="emailInput" class="font-medium">Email</label>
                            <input type="email" id="emailInput" class="input-field" placeholder="Nh·∫≠p email h·ª£p l·ªá">
                            <div id="emailValidationMsg" class="validation-message"></div>
                        </div>
                         <div>
                            <label for="passwordInput" class="font-medium">M·∫≠t kh·∫©u</label>
                            <input type="password" id="passwordInput" class="input-field" placeholder="√çt nh·∫•t 6 k√Ω t·ª±">
                            <div id="passwordValidationMsg" class="validation-message"></div>
                        </div>
                        <div class="flex items-center gap-4">
                            <button type="submit" id="submitFormBtn" class="btn btn-success" disabled>ƒêƒÉng K√Ω</button>
                            <span id="formStatus" class="font-semibold text-red-600">Vui l√≤ng ƒëi·ªÅn ƒë√∫ng th√¥ng tin.</span>
                        </div>
                    </form>
                    <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                    <div class="code-block-wrapper">
                        <div class="relative">
                            <pre><code class="language-javascript" data-code-id="formValidation"></code></pre>
                            <button class="btn btn-sm copy-code-btn">Copy</button>
                        </div>
                    </div>
                 </div>
            </section>

            <!-- Section 8: Hardcore Examples -->
            <section id="hardcore-examples" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">9. V√≠ D·ª• Kh√≥ Nh·∫±n</h2>
                
                <div class="grid grid-cols-1 gap-6">
                    <!-- Advanced Type Ahead -->
                    <div class="interactive-demo" data-demo-id="advancedSearch" data-search-terms="t√¨m ki·∫øm n√¢ng cao, search, loading, catchError">
                        <h3 class="font-semibold text-lg mb-3">9.1. T√¨m Ki·∫øm N√¢ng Cao: Loading & X·ª≠ L√Ω L·ªói</h3>
                        <p class="mb-4">T√¨m ki·∫øm th√¥ng minh v·ªõi hi·ªáu ·ª©ng loading, x·ª≠ l√Ω l·ªói v√† g·ª£i √Ω t·ª± ƒë·ªông.</p>
                        
                        <input type="text" id="advancedSearchInput" placeholder="G√µ 'error' ƒë·ªÉ th·ª≠ l·ªói API..." class="input-field mb-4">
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Stream G√µ Ph√≠m:</div>
                        <div id="advancedSearchOuterStream" class="marble-timeline"></div>
                        
                        <div class="operator-box" data-label="PIPE: X·ª≠ L√Ω">debounceTime ‚Üí distinctUntilChanged ‚Üí switchMap (API call + startWith + catchError)</div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">K·∫øt qu·∫£ t√¨m ki·∫øm:</div>
                        <div id="advancedSearchResultStream" class="marble-timeline"></div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                        <div id="advancedSearchLogger" class="bg-gray-50 p-4 rounded-lg min-h-[120px] font-mono text-sm"></div>
                        <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="advancedSearch"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <!-- Drag and Drop -->
                        <div class="interactive-demo" data-demo-id="dragDrop" data-search-terms="k√©o th·∫£, drag drop, mousedown, mousemove, mouseup">
                            <h3 class="font-semibold text-lg mb-3">9.2. K√©o Th·∫£ B·∫±ng RxJS</h3>
                            <p class="mb-4">Tri·ªÉn khai t√≠nh nƒÉng k√©o th·∫£ s·ª≠ d·ª•ng c√°c Observable ƒë·ªÉ x·ª≠ l√Ω s·ª± ki·ªán.</p>
                             <div class="demo-controls">
                                 <button id="resetDragDrop" class="btn btn-secondary btn-sm">Reset V·ªã Tr√≠</button>
                            </div>
                            <div style="position: relative; height: 250px; border: 1px solid #e5e7eb; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                                <div id="draggableBox" class="draggable" style="top: 20px; left: 20px;">K√âO T√îI</div>
                            </div>
                            
                            <div id="dropZone">Th·∫£ v√†o ƒë√¢y!</div>
                            
                            <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                            <div id="dragDropLogger" class="bg-gray-50 p-4 rounded-lg min-h-[100px] font-mono text-sm"></div>
                            <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                            <div class="code-block-wrapper">
                                <div class="relative">
                                    <pre><code class="language-javascript" data-code-id="dragDrop"></code></pre>
                                    <button class="btn btn-sm copy-code-btn">Copy</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Polling -->
                        <div class="interactive-demo" data-demo-id="polling" data-search-terms="polling, l·∫∑p l·∫°i, ƒë·ªãnh k·ª≥, timer, takeUntil">
                            <h3 class="font-semibold text-lg mb-3">9.3. L·∫•y D·ªØ Li·ªáu ƒê·ªãnh K·ª≥ (Polling)</h3>
                            <p class="mb-4">T·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu m·ªõi t·ª´ server theo chu k·ª≥ v·ªõi kh·∫£ nƒÉng d·ª´ng l·∫°i.</p>
                            
                            <div class="demo-controls">
                                <button id="startPollingBtn" class="btn btn-success">B·∫Øt ƒê·∫ßu Poll</button>
                                <button id="stopPollingBtn" class="btn btn-danger">D·ª´ng Poll</button>
                            </div>
                            
                            <div id="pollingStatus" class="text-sm text-gray-600 my-2">Tr·∫°ng th√°i: Ch∆∞a ch·∫°y</div>
                            
                            <div class="text-sm text-gray-600 mb-2 font-medium">D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:</div>
                            <div id="pollingDataStream" class="marble-timeline"></div>
                            
                            <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                            <div id="pollingLogger" class="bg-gray-50 p-4 rounded-lg min-h-[100px] font-mono text-sm"></div>
                             <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                            <div class="code-block-wrapper">
                                <div class="relative">
                                    <pre><code class="language-javascript" data-code-id="polling"></code></pre>
                                    <button class="btn btn-sm copy-code-btn">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 9: Ultra Hardcore Examples -->
            <section id="ultra-hardcore-examples" class="content-section">
                <h2 class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 section-title">10. V√≠ D·ª• Si√™u Kh√≥ Nh·∫±n</h2>
                
                <div class="interactive-demo" data-demo-id="multiApiSearch" data-search-terms="multi api, nhi·ªÅu ngu·ªìn, forkJoin, si√™u kh√≥">
                    <h3 class="font-semibold text-lg mb-3">10.1. G·ª£i √ù T·ª´ Nhi·ªÅu Ngu·ªìn API</h3>
                    <p class="mb-4">G√µ v√†o √¥ t√¨m ki·∫øm, h·ªá th·ªëng s·∫Ω g·ªçi ƒë·ªìng th·ªùi nhi·ªÅu API kh√°c nhau v√† k·∫øt h·ª£p k·∫øt qu·∫£.</p>
                    
                    <input type="text" id="multiApiSearchInput" placeholder="G√µ ƒë·ªÉ t√¨m t·ª´ 2 ngu·ªìn..." class="input-field mb-4">
                    
                    <div class="text-sm text-gray-600 mb-2 font-medium">Stream G√µ Ph√≠m:</div>
                    <div id="multiApiSearchOuterStream" class="marble-timeline"></div>
                    
                    <div class="operator-box" data-label="PIPE: X·ª≠ L√Ω">debounceTime ‚Üí distinctUntilChanged ‚Üí filter ‚Üí switchMap (forkJoin [API1, API2])</div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">API 1 Response:</div>
                            <div id="multiApi1ResultStream" class="marble-timeline min-h-[50px]"></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-2 font-medium">API 2 Response:</div>
                            <div id="multiApi2ResultStream" class="marble-timeline min-h-[50px]"></div>
                        </div>
                    </div>
                    
                    <div class="text-sm text-gray-600 mb-2 font-medium">K·∫øt qu·∫£ g·ªôp (API1 + API2):</div>
                    <div id="multiApiCombinedResultStream" class="marble-timeline"></div>
                    
                    <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                    <div id="multiApiSearchLogger" class="bg-gray-50 p-4 rounded-lg min-h-[120px] font-mono text-sm"></div>
                     <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                    <div class="code-block-wrapper">
                        <div class="relative">
                            <pre><code class="language-javascript" data-code-id="multiApiSearch"></code></pre>
                            <button class="btn btn-sm copy-code-btn">Copy</button>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <!-- Sequential Tasks -->
                    <div class="interactive-demo" data-demo-id="sequentialTasks" data-search-terms="tu·∫ßn t·ª±, chu·ªói, retry, concat, defer, th·ª≠ l·∫°i">
                        <h3 class="font-semibold text-lg mb-3">10.2. Chu·ªói T√°c V·ª• Tu·∫ßn T·ª± & Th·ª≠ L·∫°i</h3>
                        <p class="mb-4">Th·ª±c hi·ªán m·ªôt chu·ªói t√°c v·ª• tu·∫ßn t·ª±, m·ªói t√°c v·ª• c√≥ th·ªÉ th·ª≠ l·∫°i n·∫øu g·∫∑p l·ªói.</p>
                        
                        <div class="demo-controls">
                            <button id="startSequentialTasksBtn" class="btn btn-warning">B·∫Øt ƒê·∫ßu Chu·ªói T√°c V·ª•</button>
                            <button id="resetSequentialTasksBtn" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium">Ti·∫øn Tr√¨nh T√°c V·ª•:</div>
                        <div id="sequentialTasksProgressStream" class="marble-timeline"></div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                        <div id="sequentialTasksLogger" class="bg-gray-50 p-4 rounded-lg min-h-[150px] font-mono text-sm"></div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="sequentialTasks"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Infinite Scroll -->
                    <div class="interactive-demo" data-demo-id="infiniteScroll" data-search-terms="cu·ªôn v√¥ t·∫≠n, infinite scroll, t·∫£i th√™m">
                        <h3 class="font-semibold text-lg mb-3">10.3. Cu·ªôn V√¥ T·∫≠n (Infinite Scroll)</h3>
                        <p class="mb-4">T·ª± ƒë·ªông t·∫£i th√™m d·ªØ li·ªáu khi ng∆∞·ªùi d√πng cu·ªôn ƒë·∫øn cu·ªëi trang.</p>
                         <div class="demo-controls">
                             <button id="resetInfiniteScrollBtn" class="btn btn-secondary btn-sm">Reset</button>
                        </div>
                        <div id="infiniteScrollContainer">
                            <!-- Items will be added here -->
                        </div>
                        
                        <div class="text-sm text-gray-600 mb-2 font-medium mt-4">Log:</div>
                        <div id="infiniteScrollLogger" class="bg-gray-50 p-4 rounded-lg min-h-[100px] font-mono text-sm"></div>
                         <div class="mt-4 text-right"> <button class="btn btn-secondary btn-sm toggle-code-btn">Xem Code</button> </div>
                        <div class="code-block-wrapper">
                            <div class="relative">
                                <pre><code class="language-javascript" data-code-id="infiniteScroll"></code></pre>
                                <button class="btn btn-sm copy-code-btn">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="mt-12 pt-6 border-t border-gray-200 text-center text-gray-600 text-sm">
            <p>¬© 2025 H·ªçc RxJS Tr·ª±c Quan. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            <p class="mt-2">ƒê∆∞·ª£c ph√°t tri·ªÉn v·ªõi ‚ù§Ô∏è b·ªüi Nguy·ªÖn Ng·ªçc Kh√°nh</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const { Observable, fromEvent, of, pipe, Subject, timer, combineLatest, interval, BehaviorSubject, ReplaySubject, zip, throwError, EMPTY, merge, forkJoin, concat, defer, iif } = rxjs; 
            const { map, filter, tap, scan, delay, switchMap, debounceTime, distinctUntilChanged, mergeMap, concatMap, take, startWith, shareReplay, catchError, finalize, retry, takeUntil, exhaustMap, toArray, throttleTime, bufferTime, pairwise, withLatestFrom } = rxjs.operators; 

            // --- Scroll Progress Bar (Full Page) ---
            const scrollProgressBar = document.getElementById('scroll-progress-bar');
            if (scrollProgressBar) {
                 window.addEventListener('scroll', () => {
                    const scrollTop = document.documentElement.scrollTop;
                    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                    const scrollPercent = (scrollTop / scrollHeight) * 100;
                    scrollProgressBar.style.width = scrollPercent + '%';
                });
            }

            // --- NEW: Code Snippets for all demos ---
            const codeSnippets = {
                firstObservable: `const { of, concatMap, delay } = rxjs;
of('A', 'B', 'C').pipe(
    // D√πng concatMap + delay ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng
    concatMap(val => of(val).pipe(delay(300)))
).subscribe({
    next: val => console.log('Nh·∫≠n gi√° tr·ªã:', val),
    complete: () => console.log('Ho√†n th√†nh!')
});`,
                map: `const { interval, take, map, tap } = rxjs.operators;
interval(500).pipe(
    take(3),
    map(i => i + 1), // -> 1, 2, 3
    tap(val => console.log('Tr∆∞·ªõc map:', val)),
    map(val => val * 10) // -> 10, 20, 30
).subscribe(val => console.log('Sau map:', val));`,
                filter: `const { interval, take, map, tap, filter } = rxjs.operators;
interval(500).pipe(
    take(5),
    map(i => i + 1), // -> 1, 2, 3, 4, 5
    tap(val => console.log('Tr∆∞·ªõc filter:', val)),
    filter(val => val % 2 === 0) // -> 2, 4
).subscribe(val => console.log('Sau filter:', val));`,
                tap: `const { interval, take, map, tap } = rxjs.operators;
interval(500).pipe(
    take(3),
    map(i => String.fromCharCode(65 + i)), // -> 'A', 'B', 'C'
    tap(val => {
        // H√†nh ƒë·ªông ph·ª• ·ªü ƒë√¢y!
        console.log(\`TAP ƒë√£ th·∫•y: \${val}\`);
        // tap kh√¥ng thay ƒë·ªïi gi√° tr·ªã c·ªßa lu·ªìng
    })
).subscribe(val => console.log('Observer nh·∫≠n:', val));`,
                scan: `const { interval, take, map, tap, scan } = rxjs.operators;
interval(500).pipe(
    take(4),
    map(i => i + 1), // -> 1, 2, 3, 4
    tap(val => console.log('Gi√° tr·ªã hi·ªán t·∫°i:', val)),
    // Gi·ªëng reduce, nh∆∞ng ph√°t ra gi√° tr·ªã t√≠ch l≈©y ·ªü m·ªói b∆∞·ªõc
    scan((acc, curr) => acc + curr, 0) // -> 1, 3, 6, 10
).subscribe(val => console.log('T·ªïng t√≠ch l≈©y:', val));`,
                flattening: `// Code n√†y √°p d·ª•ng cho c·∫£ 4 v√≠ d·ª•: mergeMap, switchMap, concatMap, exhaustMap
// Ch·ªâ c·∫ßn thay th·∫ø operator t∆∞∆°ng ·ª©ng
const { fromEvent, interval, take, map } = rxjs;
const { mergeMap } = rxjs.operators; // Thay b·∫±ng switchMap, concatMap, exhaustMap

const clicks$ = fromEvent(runButton, 'click');

clicks$.pipe(
    // M·ªói l·∫ßn click, t·∫°o m·ªôt lu·ªìng con m·ªõi (inner observable)
    // Lu·ªìng con n√†y s·∫Ω ph√°t ra 3 gi√° tr·ªã, m·ªói gi√° tr·ªã c√°ch nhau 0.6s
    mergeMap(() => 
        interval(600).pipe(
            take(3),
            map(i => \`Click \${clickCount}: \${i}\`)
        )
    )
).subscribe(val => console.log(val));`,
                combineLatest: `const { Subject, combineLatest } = rxjs;
const sourceA$ = new Subject();
const sourceB$ = new Subject();

combineLatest([sourceA$, sourceB$]).subscribe(([valA, valB]) => {
    console.log(\`K·∫øt h·ª£p: A - \${valA}, B - \${valB}\`);
});

// Khi nh·∫•n n√∫t, ph√°t gi√° tr·ªã
emitButtonA.onclick = () => sourceA$.next('A' + countA++);
emitButtonB.onclick = () => sourceB$.next('B' + countB++);`,
                forkJoin: `const { timer, forkJoin } = rxjs;
const { map } = rxjs.operators;

// Gi·∫£ l·∫≠p 2 cu·ªôc g·ªçi API v·ªõi th·ªùi gian kh√°c nhau
const api1$ = timer(1500).pipe(map(() => 'D·ªØ li·ªáu User'));
const api2$ = timer(2500).pipe(map(() => 'C√†i ƒë·∫∑t User'));

// forkJoin s·∫Ω ch·ªù c·∫£ hai ho√†n th√†nh
forkJoin({ 
    user: api1$, 
    prefs: api2$ 
}).subscribe(result => {
    // result s·∫Ω l√†: { user: 'D·ªØ li·ªáu User', prefs: 'C√†i ƒë·∫∑t User' }
    console.log(result);
});`,
                rateLimit: `const { fromEvent } = rxjs;
const { debounceTime, throttleTime, tap } = rxjs.operators;
const click$ = fromEvent(clickButton, 'click');

// DEBOUNCE: Ch·ªâ ph√°t khi ng∆∞·ªùi d√πng ng·ª´ng click 1s
click$.pipe(
    debounceTime(1000)
).subscribe(() => console.log('DEBOUNCE ph√°t!'));

// THROTTLE: Ph√°t l·∫ßn click ƒë·∫ßu ti√™n, sau ƒë√≥ ch·ªù 1s m·ªõi ph√°t ti·∫øp
click$.pipe(
    throttleTime(1000)
).subscribe(() => console.log('THROTTLE ph√°t!'));`,
                bufferTime: `const { fromEvent, bufferTime } = rxjs;
const click$ = fromEvent(clickButton, 'click');

// Gom c√°c l·∫ßn click trong kho·∫£ng 2 gi√¢y v√† ph√°t ra nh∆∞ m·ªôt m·∫£ng
click$.pipe(
    bufferTime(2000)
).subscribe(clickArray => {
    if(clickArray.length > 0) {
        console.log(\`ƒê√£ gom ƒë∆∞·ª£c \${clickArray.length} clicks.\`);
    }
});`,
                pairwise: `const { interval, take, pairwise } = rxjs;
interval(1000).pipe(
    take(5), // -> 0, 1, 2, 3, 4
    pairwise()
).subscribe(pair => {
    // -> [0,1], [1,2], [2,3], [3,4]
    console.log('C·∫∑p gi√° tr·ªã:', pair);
});`,
                withLatestFrom: `const { fromEvent, interval, map, withLatestFrom } = rxjs;
const click$ = fromEvent(clickButton, 'click');
const timer$ = interval(1500); // Ph√°t 0, 1, 2,... m·ªói 1.5s

click$.pipe(
    // Khi click, l·∫•y gi√° tr·ªã c·ªßa l·∫ßn click
    // v√† k·∫øt h·ª£p n√≥ v·ªõi gi√° tr·ªã M·ªöI NH·∫§T t·ª´ timer$
    withLatestFrom(timer$)
).subscribe(([clickEvent, timerValue]) => {
    console.log(\`Click! Gi√° tr·ªã timer l√∫c ƒë√≥ l√†: \${timerValue}\`);
});`,
                take: `const { interval, take, tap } = rxjs;
const count = 3; // L·∫•y t·ª´ input

interval(500).pipe(
    tap(val => console.log('Input:', val + 1)),
    take(count) // Ch·ªâ l·∫•y 'count' gi√° tr·ªã ƒë·∫ßu ti√™n r·ªìi complete
).subscribe({
    next: val => console.log('Output:', val + 1),
    complete: () => console.log('Ho√†n th√†nh!')
});`,
                zip: `const { Subject, zip } = rxjs;
const streamA$ = new Subject(); // Ph√°t s·ªë
const streamB$ = new Subject(); // Ph√°t ch·ªØ

// Gh√©p c·∫∑p gi√° tr·ªã t·ª´ 2 stream theo th·ª© t·ª± 1-1
zip(streamA$, streamB$).subscribe(([num, char]) => {
    console.log(\`Gh√©p c·∫∑p: \${num} v√† \${char}\`);
});

// Ph√°t gi√° tr·ªã
streamA$.next(1); // Ch·ªù...
streamB$.next('A'); // Output: Gh√©p c·∫∑p: 1 v√† A

streamA$.next(2); // Ch·ªù...
streamB$.next('B'); // Output: Gh√©p c·∫∑p: 2 v√† B`,
                catchError: `const { Observable, of } = rxjs;
const { catchError } = rxjs.operators;

// Lu·ªìng n√†y s·∫Ω ph√°t l·ªói
const source$ = new Observable(sub => {
    sub.next(1);
    sub.next(2);
    sub.error('B√ôM!');
});

source$.pipe(
    // B·∫Øt l·ªói v√† tr·∫£ v·ªÅ m·ªôt lu·ªìng thay th·∫ø
    catchError(err => {
        console.log('ƒê√£ b·∫Øt l·ªói:', err);
        return of('Gi√° tr·ªã thay th·∫ø'); // Tr·∫£ v·ªÅ Observable m·ªõi
    })
).subscribe(val => console.log('Observer nh·∫≠n:', val));`,
                startWith: `const { of, delay, concatMap, startWith } = rxjs;
const source$ = of(1, 2, 3).pipe(
    concatMap(val => of(val).pipe(delay(500))) // Gi·∫£ l·∫≠p lu·ªìng c√≥ ƒë·ªô tr·ªÖ
);

source$.pipe(
    // Th√™m c√°c gi√° tr·ªã n√†y v√†o ƒê·∫¶U lu·ªìng m·ªôt c√°ch ƒë·ªìng b·ªô
    startWith('B·∫Øt ƒë·∫ßu!', 0)
).subscribe(val => console.log(val));
// Output: 'B·∫Øt ƒë·∫ßu!', 0, (sau 0.5s) 1, (sau 0.5s) 2, (sau 0.5s) 3`,
                subject: `const { Subject } = rxjs;
const subject = new Subject();

// Sub1 ƒëƒÉng k√Ω tr∆∞·ªõc
const sub1 = subject.subscribe(val => console.log(\`Sub1 nh·∫≠n: \${val}\`));

subject.next(1); // Sub1 nh·∫≠n: 1
subject.next(2); // Sub1 nh·∫≠n: 2

// Sub2 ƒëƒÉng k√Ω sau
const sub2 = subject.subscribe(val => console.log(\`Sub2 nh·∫≠n: \${val}\`));

subject.next(3); // Sub1 nh·∫≠n: 3, Sub2 nh·∫≠n: 3`,
                behaviorSubject: `const { BehaviorSubject } = rxjs;
// Kh·ªüi t·∫°o v·ªõi gi√° tr·ªã ban ƒë·∫ßu l√† 'Hi·∫øu'
const subject = new BehaviorSubject('Hi·∫øu');

const sub1 = subject.subscribe(val => console.log(\`Sub1 nh·∫≠n: \${val}\`));
// Output ngay l·∫≠p t·ª©c: Sub1 nh·∫≠n: Hi·∫øu

subject.next('ƒê·∫πp'); // Sub1 nh·∫≠n: ƒê·∫πp
subject.next('Trai'); // Sub1 nh·∫≠n: Trai

// Sub2 ƒëƒÉng k√Ω sau, s·∫Ω nh·∫≠n ngay gi√° tr·ªã cu·ªëi c√πng ('Trai')
const sub2 = subject.subscribe(val => console.log(\`Sub2 nh·∫≠n: \${val}\`));
// Output ngay l·∫≠p t·ª©c: Sub2 nh·∫≠n: Trai`,
                replaySubject: `const { ReplaySubject } = rxjs;
// L∆∞u v√† ph√°t l·∫°i 2 gi√° tr·ªã cu·ªëi c√πng
const subject = new ReplaySubject(2);

subject.next(1);
subject.next(2);
subject.next(3); // C√°c gi√° tr·ªã hi·ªán c√≥: 2, 3

const sub1 = subject.subscribe(val => console.log(\`Sub1 nh·∫≠n: \${val}\`));
// Output ngay l·∫≠p t·ª©c: Sub1 nh·∫≠n: 2, Sub1 nh·∫≠n: 3

subject.next(4); // Sub1 nh·∫≠n: 4

// Sub2 ƒëƒÉng k√Ω, s·∫Ω nh·∫≠n l·∫°i 2 gi√° tr·ªã cu·ªëi c√πng l√† 3 v√† 4
const sub2 = subject.subscribe(val => console.log(\`Sub2 nh·∫≠n: \${val}\`));
// Output ngay l·∫≠p t·ª©c: Sub2 nh·∫≠n: 3, Sub2 nh·∫≠n: 4`,
                typeahead: `const { fromEvent, timer, of } = rxjs;
const { map, debounceTime, distinctUntilChanged, switchMap, tap } = rxjs.operators;

const input = document.getElementById('typeaheadInput');
const resultsEl = document.getElementById('typeaheadResult');

const fakeApiSearch = (term) => timer(500).pipe(map(() => \`K·∫øt qu·∫£ cho '\${term}'\`));

fromEvent(input, 'input').pipe(
    map(event => event.target.value),
    debounceTime(400), // Ch·ªù ng∆∞·ªùi d√πng ng·ª´ng g√µ 400ms
    distinctUntilChanged(), // Ch·ªâ t√¨m ki·∫øm n·∫øu gi√° tr·ªã thay ƒë·ªïi
    tap(() => resultsEl.innerHTML = 'ƒêang t√¨m ki·∫øm...'),
    // H·ªßy request c≈© v√† th·ª±c hi·ªán request m·ªõi
    switchMap(term => term ? fakeApiSearch(term) : of('G√µ ƒë·ªÉ t√¨m ki·∫øm'))
).subscribe(result => resultsEl.textContent = result);`,
                progressBar: `const { fromEvent, interval, take, finalize } = rxjs;
const { exhaustMap } = rxjs.operators;

const startBtn = document.getElementById('startProgressBar');
const progressFill = document.getElementById('progressFill');

fromEvent(startBtn, 'click').pipe(
    // exhaustMap ngƒÉn click li√™n t·ª•c khi ƒëang t·∫£i
    exhaustMap(() => {
        startBtn.disabled = true;
        // T·∫°o m·ªôt lu·ªìng ƒë·∫øm t·ª´ 0 ƒë·∫øn 100
        return interval(40).pipe(
            take(101),
            // finalize s·∫Ω ch·∫°y khi lu·ªìng take(101) ho√†n th√†nh ho·∫∑c l·ªói
            finalize(() => startBtn.disabled = false)
        );
    })
).subscribe(percentage => {
    progressFill.style.width = \`\${percentage}%\`;
});`,
                formValidation: `const { fromEvent, combineLatest, timer, of } = rxjs;
const { map, startWith, debounceTime, distinctUntilChanged, switchMap, shareReplay } = rxjs.operators;

// Helper t·∫°o stream x√°c th·ª±c cho m·ªôt input
const createValidationStream = (inputEl, validationFn) => fromEvent(inputEl, 'input').pipe(
    map(event => event.target.value),
    startWith(inputEl.value || ''),
    debounceTime(500),
    distinctUntilChanged(),
    switchMap(validationFn),
    shareReplay(1) // Cache k·∫øt qu·∫£ cu·ªëi ƒë·ªÉ c√°c stream kh√°c kh√¥ng c·∫ßn t√≠nh l·∫°i
);

// Stream cho t·ª´ng input
const username$ = createValidationStream(...);
const email$ = createValidationStream(...);
const password$ = createValidationStream(...);

// K·∫øt h·ª£p tr·∫°ng th√°i c·ªßa c·∫£ 3 stream
const formValid$ = combineLatest(
    [username$, email$, password$]
).pipe(
    map(([user, email, pass]) => user.valid && email.valid && pass.valid)
);

// C·∫≠p nh·∫≠t UI d·ª±a tr√™n tr·∫°ng th√°i form
formValid$.subscribe(isValid => {
    submitBtn.disabled = !isValid;
});`,
                advancedSearch: `const { fromEvent, timer, of, EMPTY } = rxjs;
const { map, tap, debounceTime, distinctUntilChanged, switchMap, startWith, catchError } = rxjs.operators;

const fakeApiCall = (query) => timer(1000).pipe(map(() => { 
    if (query.toLowerCase() === 'error') throw new Error('API c·ªë t√¨nh l·ªói!'); 
    return \`K·∫øt qu·∫£ cho '\${query}'\`; 
}));

fromEvent(searchInput, 'input').pipe(
    map(event => event.target.value),
    debounceTime(500), 
    distinctUntilChanged(),
    switchMap(query => {
        if (!query.trim()) return EMPTY; // Kh√¥ng l√†m g√¨ n·∫øu input r·ªóng
        
        return fakeApiCall(query).pipe(
            startWith('ƒêang t·∫£i...'), // Hi·ªÉn th·ªã tr·∫°ng th√°i loading ngay l·∫≠p t·ª©c
            catchError(err => of(\`L·ªói: \${err.message}\`)) // X·ª≠ l√Ω l·ªói
        );
    })
).subscribe(result => {
    // C·∫≠p nh·∫≠t UI
    console.log(result);
});`,
                dragDrop: `const { fromEvent, takeUntil, exhaustMap, map, tap } = rxjs;

const mouseDown$ = fromEvent(draggableBox, 'mousedown');
const mouseMove$ = fromEvent(document, 'mousemove');
const mouseUp$ = fromEvent(document, 'mouseup');

mouseDown$.pipe(
    tap(e => e.preventDefault()),
    // exhaustMap ƒë·ªÉ b·ªè qua c√°c l·∫ßn nh·∫•n chu·ªôt khi ƒëang k√©o
    exhaustMap(downEvent => {
        const startX = draggableBox.offsetLeft;
        const startY = draggableBox.offsetTop;
        
        // L·∫•y stream c√°c v·ªã tr√≠ di chu·ªôt
        return mouseMove$.pipe(
            map(moveEvent => ({
                x: startX + (moveEvent.clientX - downEvent.clientX),
                y: startY + (moveEvent.clientY - downEvent.clientY)
            })),
            // D·ª´ng l·∫Øng nghe khi nh·∫£ chu·ªôt
            takeUntil(mouseUp$)
        );
    })
).subscribe(pos => {
    // C·∫≠p nh·∫≠t v·ªã tr√≠ c·ªßa box
    draggableBox.style.left = \`\${pos.x}px\`;
    draggableBox.style.top = \`\${pos.y}px\`;
});`,
                polling: `const { fromEvent, timer, switchMap, takeUntil, tap } = rxjs;
const start$ = fromEvent(startBtn, 'click');
const stop$ = fromEvent(stopBtn, 'click');
const fetchData = () => timer(500).pipe(map(() => \`Data \${new Date().toLocaleTimeString()}\`));

start$.pipe(
    // switchMap ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt chu k·ª≥ polling m·ªõi m·ªói khi nh·∫•n start
    switchMap(() => 
        // timer(0, 3000) ph√°t ngay l·∫≠p t·ª©c, v√† sau ƒë√≥ m·ªói 3 gi√¢y
        timer(0, 3000).pipe(
            tap(() => console.log('ƒêang l·∫•y d·ªØ li·ªáu...')),
            switchMap(fetchData),
            // takeUntil s·∫Ω d·ª´ng polling khi stop$ ph√°t ra gi√° tr·ªã
            takeUntil(stop$.pipe(tap(() => console.log('--- D·ª´ng Poll ---'))))
        )
    )
).subscribe(data => console.log(data));`,
                multiApiSearch: `const { fromEvent, forkJoin, timer } = rxjs;
const { map, filter, debounceTime, distinctUntilChanged, switchMap, tap } = rxjs.operators;

const fakeApi1 = (q) => timer(600).pipe(map(() => [\`API1:\${q}-A\`]));
const fakeApi2 = (q) => timer(1000).pipe(map(() => [\`API2:\${q}-X\`]));

fromEvent(searchInput, 'input').pipe(
    map(event => event.target.value),
    debounceTime(700),
    distinctUntilChanged(),
    filter(q => q.length > 1),
    tap(() => console.log('ƒêang t·∫£i...')),
    switchMap(q => 
        forkJoin([ fakeApi1(q), fakeApi2(q) ]).pipe(
            map(results => results.flat()) // G·ªôp k·∫øt qu·∫£ t·ª´ 2 API
        )
    )
).subscribe(results => console.log('K·∫øt qu·∫£ g·ªôp:', results));`,
                sequentialTasks: `const { of, concat, defer, throwError, timer } = rxjs;
const { delay, tap, retry, catchError, mergeMap } = rxjs.operators;

const task1$ = of('1. X√°c th·ª±c').pipe(delay(800));
// defer ƒë·ªÉ logic th·ª≠ l·∫°i ƒë∆∞·ª£c th·ª±c thi m·ªói l·∫ßn retry
const task2$ = defer(() => {
    if (Math.random() > 0.5) return timer(1000).pipe(map(() => '2. L·∫•y d·ªØ li·ªáu OK'));
    return timer(1000).pipe(mergeMap(() => throwError(() => 'L·ªói m·∫°ng')));
}).pipe(
    retry(1), // Th·ª≠ l·∫°i 1 l·∫ßn n·∫øu l·ªói
    catchError(() => of('2. L·∫•y d·ªØ li·ªáu th·∫•t b·∫°i'))
);
const task3$ = of('3. Hi·ªÉn th·ªã').pipe(delay(600));

// concat ƒë·∫£m b·∫£o c√°c t√°c v·ª• ch·∫°y tu·∫ßn t·ª±
concat(task1$, task2$, task3$).subscribe(msg => console.log(msg));`,
                infiniteScroll: `const { fromEvent, exhaustMap, filter, debounceTime } = rxjs;

const scroll$ = fromEvent(scrollContainer, 'scroll');

// Stream ph√°t ra khi ng∆∞·ªùi d√πng cu·ªôn g·∫ßn ƒë·∫øn cu·ªëi
const loadMore$ = scroll$.pipe(
    // L·ªçc c√°c s·ª± ki·ªán kh√¥ng c·∫ßn thi·∫øt
    filter(() => !isLoading && isNearBottom(scrollContainer)),
    debounceTime(200) // Tr√°nh g·ªçi li√™n t·ª•c
);

loadMore$.pipe(
    // exhaustMap ƒë·ªÉ ch·ªâ x·ª≠ l√Ω 1 y√™u c·∫ßu t·∫£i t·∫°i m·ªôt th·ªùi ƒëi·ªÉm
    exhaustMap(() => fetchItems(currentPage++))
).subscribe(newItems => {
    // Th√™m item v√†o UI
    appendItems(newItems);
});`
            };
            
            // --- NEW: App Logic (Search, Code Toggle, Copy) ---
            function setupAppFeatures() {
                // 1. Inject code snippets and highlight
                document.querySelectorAll('[data-code-id]').forEach(el => {
                    const codeId = el.dataset.codeId;
                    if (codeSnippets[codeId]) {
                        el.textContent = codeSnippets[codeId];
                    }
                });
                hljs.highlightAll();

                // 2. Search logic
                const searchInput = document.getElementById('searchInput');
                const allDemos = document.querySelectorAll('[data-demo-id]');
                if(searchInput) {
                    fromEvent(searchInput, 'input').pipe(
                        debounceTime(300),
                        map(event => event.target.value.toLowerCase().trim()),
                        distinctUntilChanged(),
                    ).subscribe(searchTerm => {
                        allDemos.forEach(demo => {
                            const searchTerms = (demo.dataset.searchTerms || '').toLowerCase();
                            const isVisible = searchTerms.includes(searchTerm);
                            demo.style.display = isVisible ? '' : 'none';
                        });
                    });
                }
                
                // 3. Event delegation for "View Code" and "Copy" buttons
                document.body.addEventListener('click', event => {
                    // Toggle Code
                    if (event.target.classList.contains('toggle-code-btn')) {
                        const btn = event.target;
                        const demo = btn.closest('.interactive-demo');
                        if(demo) {
                           const wrapper = demo.querySelector('.code-block-wrapper');
                           if(wrapper) {
                               wrapper.classList.toggle('show');
                               btn.textContent = wrapper.classList.contains('show') ? '·∫®n Code' : 'Xem Code';
                           }
                        }
                    }
                    // Copy Code
                    if (event.target.classList.contains('copy-code-btn')) {
                        const btn = event.target;
                        const pre = btn.previousElementSibling;
                        if(pre && pre.tagName === 'PRE') {
                            const code = pre.querySelector('code').textContent;
                            navigator.clipboard.writeText(code).then(() => {
                                const originalText = btn.textContent;
                                btn.textContent = 'ƒê√£ ch√©p!';
                                btn.classList.add('copied');
                                setTimeout(() => {
                                    btn.textContent = originalText;
                                    btn.classList.remove('copied');
                                }, 2000);
                            });
                        }
                    }
                });
            }
            
            // Run new features setup
            setupAppFeatures();
            
            // --- Confetti effect for Drag & Drop ---
            function createConfetti() {
                const container = document.getElementById('confetti-container');
                const dropZoneEl = document.getElementById('dropZone');
                if (!container || !dropZoneEl) return;
                const colors = ['#2563eb', '#22c55e', '#f59e0b', '#ef4444', '#9b59b6'];
                const dropZoneRect = dropZoneEl.getBoundingClientRect();

                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'absolute';
                    confetti.style.width = `${Math.random() * 8 + 4}px`;
                    confetti.style.height = confetti.style.width;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    const startX = dropZoneRect.left + dropZoneRect.width / 2;
                    const startY = dropZoneRect.top + dropZoneRect.height / 2;
                    confetti.style.left = `${startX}px`;
                    confetti.style.top = `${startY}px`;
                    confetti.style.opacity = '1';
                    
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 200 + 150;
                    const endX = Math.cos(angle) * velocity;
                    const endY = Math.sin(angle) * velocity;

                    const anim = confetti.animate([
                        { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                        { transform: `translate(${endX}px, ${endY}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 1000 + 800,
                        easing: 'cubic-bezier(0.1, 0.9, 0.2, 1)',
                    });
                    anim.onfinish = () => confetti.remove();
                    container.appendChild(confetti);
                }
            }


            // --- Navigation ---
            const navButtons = document.querySelectorAll('.nav-button');
            const contentSections = document.querySelectorAll('.content-section');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const sectionId = button.dataset.section;
                    contentSections.forEach(section => {
                        section.classList.toggle('active', section.id === sectionId);
                    });
                     window.scrollTo(0, 0);
                });
            });
            
            // --- Helper functions ---
            function addMarble(containerElement, value, isOutput = false, customDelay = 0, color = null, specialClass = null) {
                if (!containerElement) return null;
                const marble = document.createElement('div');
                marble.classList.add('marble');
                if (specialClass) marble.classList.add(specialClass);
                if (color) { marble.style.backgroundColor = color; } 
                else if (isOutput) { marble.style.backgroundColor = '#2ecc71';}
                
                let displayValue = String(value);

                if (specialClass === 'complete') {
                    displayValue = '';
                } else if (Array.isArray(value)) { 
                    displayValue = `[${value.map(v => String(v).length > 7 ? String(v).substring(0,5)+'..' : v).join(',')}]`; 
                } else if (typeof value === 'object' && value !== null && value.message) { 
                    displayValue = `X`;
                    marble.classList.add('error');
                } else if (value === 'ƒêang t·∫£i...' || (typeof value === 'string' && value.startsWith('LOAD P'))) { 
                    marble.classList.add('loading'); 
                }
                
                if (displayValue.length > 20 && !Array.isArray(value)) displayValue = displayValue.substring(0,17)+'..';
                marble.textContent = displayValue; 
                
                const existingMarbles = containerElement.querySelectorAll('.marble').length;
                marble.style.animationDelay = `${customDelay || (existingMarbles * 100)}ms`;
                containerElement.appendChild(marble);
                
                return marble; 
            }
            
            function addCompletionMarble(containerElement, delay = 0) { 
                if (!containerElement) return; 
                addMarble(containerElement, '', false, delay, '#7f8c8d', 'complete'); 
            }
            
            function clearStream(...elements) { 
                 elements.forEach(el => { if (el) el.innerHTML = ''; });
            }
            
            function logTo(element, message, isError = false) {
                if (!element) return;
                const p = document.createElement('p');
                const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit', fractionalSecondDigits: 2 });
                p.textContent = `[${timestamp}] ${message}`;
                if (isError) p.style.color = 'red';
                element.appendChild(p); 
                element.scrollTop = element.scrollHeight; 
            }

            const subscriptions = new Map();
            function manageSub(key, sub) {
                if (subscriptions.has(key)) {
                    subscriptions.get(key).unsubscribe();
                }
                subscriptions.set(key, sub);
            }
            function cleanupSub(key) {
                 if (subscriptions.has(key)) {
                    subscriptions.get(key).unsubscribe();
                    subscriptions.delete(key);
                }
            }

            // --- Section 1: Intro ---
            const firstObservableStreamEl = document.getElementById('firstObservableStream');
            const firstObserverOutputEl = document.getElementById('firstObserverOutput');
            
            function resetFirstObservable() {
                cleanupSub('first');
                clearStream(firstObservableStreamEl, firstObserverOutputEl);
            }
            function runFirstObservable() {
                resetFirstObservable();
                logTo(firstObserverOutputEl, 'B·∫Øt ƒë·∫ßu subscribe...');

                const sub = of('A', 'B', 'C').pipe(
                    concatMap(val => of(val).pipe(delay(300)))
                ).subscribe({
                    next: val => {
                        addMarble(firstObservableStreamEl, val, true);
                        logTo(firstObserverOutputEl, `Nh·∫≠n gi√° tr·ªã (next): ${val}`);
                    },
                    complete: () => {
                        addCompletionMarble(firstObservableStreamEl, 100);
                        logTo(firstObserverOutputEl, 'ƒê√£ ho√†n th√†nh (complete)!');
                    }
                });
                manageSub('first', sub);
            }
            document.getElementById('runFirstObservable')?.addEventListener('click', runFirstObservable);
            document.getElementById('resetFirstObservable')?.addEventListener('click', resetFirstObservable);


            // --- Section 2: Basic Operators ---
            const mapInputStreamEl = document.getElementById('mapInputStream');
            const mapOutputStreamEl = document.getElementById('mapOutputStream');
            function resetMap() {
                cleanupSub('map');
                clearStream(mapInputStreamEl, mapOutputStreamEl);
            }
            function runMap() {
                resetMap();
                const sub = interval(500).pipe(
                    take(3),
                    map(i => i + 1),
                    tap(val => addMarble(mapInputStreamEl, val, false)),
                    map(val => val * 10)
                ).subscribe({
                    next: val => addMarble(mapOutputStreamEl, val, true),
                    complete: () => {
                        addCompletionMarble(mapInputStreamEl, 100);
                        addCompletionMarble(mapOutputStreamEl, 100);
                    }
                });
                manageSub('map', sub);
            }
            document.getElementById('runMapOperator')?.addEventListener('click', runMap);
            document.getElementById('resetMapOperator')?.addEventListener('click', resetMap);

            const filterInputStreamEl = document.getElementById('filterInputStream');
            const filterOutputStreamEl = document.getElementById('filterOutputStream');
            function resetFilter() {
                 cleanupSub('filter');
                 clearStream(filterInputStreamEl, filterOutputStreamEl);
            }
            function runFilter() {
                resetFilter();
                const sub = interval(500).pipe(
                    take(5),
                    map(i => i + 1),
                    tap(val => addMarble(filterInputStreamEl, val, false)),
                    filter(val => val % 2 === 0)
                ).subscribe({
                    next: val => addMarble(filterOutputStreamEl, val, true),
                    complete: () => {
                        addCompletionMarble(filterInputStreamEl, 100);
                        addCompletionMarble(filterOutputStreamEl, 100);
                    }
                });
                manageSub('filter', sub);
            }
            document.getElementById('runFilterOperator')?.addEventListener('click', runFilter);
            document.getElementById('resetFilterOperator')?.addEventListener('click', resetFilter);

            const tapInputStreamEl = document.getElementById('tapInputStream');
            const tapOutputStreamEl = document.getElementById('tapOutputStream');
            const tapLoggerOutputEl = document.getElementById('tapLoggerOutput');
            function resetTap() {
                cleanupSub('tap');
                clearStream(tapInputStreamEl, tapOutputStreamEl, tapLoggerOutputEl);
            }
            function runTap() {
                resetTap();
                const sub = interval(500).pipe(
                    take(3),
                    map(i => String.fromCharCode(65 + i)),
                    tap(val => {
                        addMarble(tapInputStreamEl, val, false);
                        logTo(tapLoggerOutputEl, `TAP ƒë√£ th·∫•y: ${val}`);
                    })
                ).subscribe({
                    next: val => addMarble(tapOutputStreamEl, val, true),
                    complete: () => {
                        addCompletionMarble(tapInputStreamEl, 100);
                        addCompletionMarble(tapOutputStreamEl, 100);
                    }
                });
                manageSub('tap', sub);
            }
            document.getElementById('runTapOperator')?.addEventListener('click', runTap);
            document.getElementById('resetTapOperator')?.addEventListener('click', resetTap);

            const scanInputStreamEl = document.getElementById('scanInputStream');
            const scanOutputStreamEl = document.getElementById('scanOutputStream');
            function resetScan() {
                cleanupSub('scan');
                clearStream(scanInputStreamEl, scanOutputStreamEl);
            }
            function runScan() {
                resetScan();
                const sub = interval(500).pipe(
                    take(4),
                    map(i => i + 1),
                    tap(val => addMarble(scanInputStreamEl, val, false)),
                    scan((acc, curr) => acc + curr, 0)
                ).subscribe({
                    next: val => addMarble(scanOutputStreamEl, val, true),
                    complete: () => {
                        addCompletionMarble(scanInputStreamEl, 100);
                        addCompletionMarble(scanOutputStreamEl, 100);
                    }
                });
                manageSub('scan', sub);
            }
            document.getElementById('runScanOperator')?.addEventListener('click', runScan);
            document.getElementById('resetScanOperator')?.addEventListener('click', resetScan);

            // --- Section 3: Flattening Operators ---
            function setupFlatteningDemo(opName, btnId, resetBtnId, inputStreamId, outputStreamId, operator) {
                const runBtn = document.getElementById(btnId);
                const resetBtn = document.getElementById(resetBtnId);
                const inputStreamEl = document.getElementById(inputStreamId);
                const outputStreamEl = document.getElementById(outputStreamId);
                
                if (!runBtn || !resetBtn) return;
                
                let outerCounter = 0;
                const colors = ['#1abc9c', '#3498db', '#9b59b6', '#f1c40f', '#e67e22'];
                
                function reset() {
                    cleanupSub(opName);
                    cleanupSub(`${opName}Clicks`);
                    clearStream(inputStreamEl, outputStreamEl);
                    outerCounter = 0;
                }
                
                function run() {
                    if(subscriptions.has(opName)) return;

                    const clicks$ = fromEvent(runBtn, 'click');
                    manageSub(`${opName}Clicks`, clicks$.subscribe(() => {}));

                    const sub = clicks$.pipe(
                        map(() => {
                            const count = outerCounter++;
                            const color = colors[count % colors.length];
                            addMarble(inputStreamEl, `Click ${count}`, false, 0, color);
                            return interval(600).pipe(
                                take(3),
                                map(i => `${count}.${i}`),
                                finalize(() => addCompletionMarble(outputStreamEl, 100))
                            );
                        }),
                        operator()
                    ).subscribe(val => {
                         const color = colors[parseInt(val.split('.')[0]) % colors.length];
                         addMarble(outputStreamEl, val, true, 0, color);
                    });
                    manageSub(opName, sub);
                }
                runBtn.addEventListener('click', run);
                resetBtn.addEventListener('click', reset);
            }
            setupFlatteningDemo('mergeMap', 'runMergeMap', 'resetMergeMap', 'mergeMapInputStream', 'mergeMapOutputStream', () => mergeMap(inner$ => inner$));
            setupFlatteningDemo('switchMap', 'runSwitchMap', 'resetSwitchMap', 'switchMapInputStream', 'switchMapOutputStream', () => switchMap(inner$ => inner$));
            setupFlatteningDemo('concatMap', 'runConcatMap', 'resetConcatMap', 'concatMapInputStream', 'concatMapOutputStream', () => concatMap(inner$ => inner$));
            setupFlatteningDemo('exhaustMap', 'runExhaustMap', 'resetExhaustMap', 'exhaustMapInputStream', 'exhaustMapOutputStream', () => exhaustMap(inner$ => inner$));

            // --- Section 4: Combination Operators ---
            const combineSourceAEl = document.getElementById('combineSourceAStream');
            const combineSourceBEl = document.getElementById('combineSourceBStream');
            const combineOutputEl = document.getElementById('combineOutputStream');
            let combineSourceA$, combineSourceB$;
            let countA = 0, countB = 0;

            function resetCombine() {
                cleanupSub('combine');
                if (combineSourceA$) combineSourceA$.complete();
                if (combineSourceB$) combineSourceB$.complete();
                clearStream(combineSourceAEl, combineSourceBEl, combineOutputEl);
                countA = 0;
                countB = 0;
                runCombine();
            }
            function runCombine() {
                combineSourceA$ = new Subject();
                combineSourceB$ = new Subject();
                const sub = combineLatest([combineSourceA$, combineSourceB$]).subscribe(([valA, valB]) => {
                    addMarble(combineOutputEl, [valA, valB], true);
                });
                manageSub('combine', sub);
            }
            document.getElementById('emitSourceACombine')?.addEventListener('click', () => {
                const val = `A${++countA}`;
                combineSourceA$.next(val);
                addMarble(combineSourceAEl, val, false, 0, '#9b59b6');
            });
            document.getElementById('emitSourceBCombine')?.addEventListener('click', () => {
                 const val = `B${++countB}`;
                combineSourceB$.next(val);
                addMarble(combineSourceBEl, val, false, 0, '#e67e22');
            });
            document.getElementById('resetCombine')?.addEventListener('click', resetCombine);
            runCombine();

            const forkJoinSource1El = document.getElementById('forkJoinSource1Stream');
            const forkJoinSource2El = document.getElementById('forkJoinSource2Stream');
            const forkJoinOutputEl = document.getElementById('forkJoinOutputStream');
            function resetForkJoin() {
                cleanupSub('forkJoin');
                clearStream(forkJoinSource1El, forkJoinSource2El, forkJoinOutputEl);
            }
            function runForkJoin() {
                resetForkJoin();
                addMarble(forkJoinSource1El, 'loading', false, 0, null, 'loading');
                addMarble(forkJoinSource2El, 'loading', false, 0, null, 'loading');

                const api1$ = timer(1500).pipe(map(() => 'User Data'), tap(v => { clearStream(forkJoinSource1El); addMarble(forkJoinSource1El, v, false, 0, '#16a085');}));
                const api2$ = timer(2500).pipe(map(() => 'User Prefs'), tap(v => { clearStream(forkJoinSource2El); addMarble(forkJoinSource2El, v, false, 0, '#27ae60');}));

                const sub = forkJoin({ api1: api1$, api2: api2$ }).subscribe(result => {
                    addMarble(forkJoinOutputEl, Object.values(result), true);
                });
                manageSub('forkJoin', sub);
            }
            document.getElementById('runForkJoin')?.addEventListener('click', runForkJoin);
            document.getElementById('resetForkJoin')?.addEventListener('click', resetForkJoin);

            // --- Section 5: Utility Operators ---
            const rateLimitInputStreamEl = document.getElementById('rateLimitInputStream');
            const debounceOutputStreamEl = document.getElementById('debounceOutputStream');
            const throttleOutputStreamEl = document.getElementById('throttleOutputStream');
            function resetRateLimit() {
                cleanupSub('rateLimitClicks');
                cleanupSub('debounceRate');
                cleanupSub('throttleRate');
                clearStream(rateLimitInputStreamEl, debounceOutputStreamEl, throttleOutputStreamEl);
            }
            function runRateLimit() {
                if(subscriptions.has('rateLimitClicks')) return;

                const click$ = fromEvent(document.getElementById('runRateLimit'), 'click');
                const sharedClicks$ = click$.pipe(shareReplay());
                
                const sub = sharedClicks$.pipe(
                    tap(() => addMarble(rateLimitInputStreamEl, 'Click', false, 0, '#f39c12'))
                ).subscribe();
                manageSub('rateLimitClicks', sub);

                const sub2 = sharedClicks$.pipe(debounceTime(1000)).subscribe(() => {
                    addMarble(debounceOutputStreamEl, 'Emit', true);
                });
                 manageSub('debounceRate', sub2);

                const sub3 = sharedClicks$.pipe(throttleTime(1000)).subscribe(() => {
                    addMarble(throttleOutputStreamEl, 'Emit', true);
                });
                manageSub('throttleRate', sub3);
            }
            document.getElementById('runRateLimit')?.addEventListener('click', runRateLimit);
            document.getElementById('resetRateLimit')?.addEventListener('click', resetRateLimit);

            const bufferTimeInputStreamEl = document.getElementById('bufferTimeInputStream');
            const bufferTimeOutputStreamEl = document.getElementById('bufferTimeOutputStream');
            function resetBufferTime() {
                cleanupSub('bufferTime');
                cleanupSub('bufferTimeClicks');
                clearStream(bufferTimeInputStreamEl, bufferTimeOutputStreamEl);
            }
            function runBufferTime() {
                 if(subscriptions.has('bufferTime')) return;
                let clickCount = 0;
                const click$ = fromEvent(document.getElementById('runBufferTime'), 'click').pipe(
                    map(() => ++clickCount)
                );

                const clickSub = click$.subscribe(val => addMarble(bufferTimeInputStreamEl, val, false, 0, '#16a085'));
                manageSub('bufferTimeClicks', clickSub);

                const sub = click$.pipe(bufferTime(2000)).subscribe(val => {
                    if (val.length > 0) addMarble(bufferTimeOutputStreamEl, val, true);
                });
                manageSub('bufferTime', sub);
            }
            document.getElementById('runBufferTime')?.addEventListener('click', runBufferTime);
            document.getElementById('resetBufferTime')?.addEventListener('click', resetBufferTime);
            
            const pairwiseInputStreamEl = document.getElementById('pairwiseInputStream');
            const pairwiseOutputStreamEl = document.getElementById('pairwiseOutputStream');
            function resetPairwise() {
                cleanupSub('pairwise');
                clearStream(pairwiseInputStreamEl, pairwiseOutputStreamEl);
            }
            function runPairwise() {
                resetPairwise();
                const sub = interval(1000).pipe(
                    take(5),
                    tap(val => addMarble(pairwiseInputStreamEl, val, false)),
                    pairwise()
                ).subscribe({
                    next: val => addMarble(pairwiseOutputStreamEl, val, true),
                    complete: () => {
                        addCompletionMarble(pairwiseInputStreamEl, 100);
                        addCompletionMarble(pairwiseOutputStreamEl, 100);
                    }
                });
                manageSub('pairwise', sub);
            }
            document.getElementById('runPairwise')?.addEventListener('click', runPairwise);
            document.getElementById('resetPairwise')?.addEventListener('click', resetPairwise);

            const wlfSourceStreamEl = document.getElementById('wlfSourceStream');
            const wlfOtherStreamEl = document.getElementById('wlfOtherStream');
            const wlfOutputStreamEl = document.getElementById('wlfOutputStream');
            function resetWithLatestFrom() {
                 cleanupSub('wlf');
                 cleanupSub('wlfClicks');
                 cleanupSub('wlfTimer');
                 clearStream(wlfSourceStreamEl, wlfOtherStreamEl, wlfOutputStreamEl);
            }
            function runWithLatestFrom() {
                if (subscriptions.has('wlf')) return;
                let clickCount = 0;
                const click$ = fromEvent(document.getElementById('runWithLatestFrom'), 'click').pipe(
                    map(() => `C${++clickCount}`)
                );
                const timer$ = interval(1500).pipe(map(i => `T${i}`));

                const timerSub = timer$.subscribe(val => addMarble(wlfOtherStreamEl, val, false, 0, '#e67e22'));
                manageSub('wlfTimer', timerSub);
                
                const clickSub = click$.subscribe(val => addMarble(wlfSourceStreamEl, val, false, 0, '#9b59b6'));
                manageSub('wlfClicks', clickSub);

                const sub = click$.pipe(withLatestFrom(timer$)).subscribe(val => {
                    addMarble(wlfOutputStreamEl, val, true);
                });
                manageSub('wlf', sub);
            }
            document.getElementById('runWithLatestFrom')?.addEventListener('click', runWithLatestFrom);
            document.getElementById('resetWithLatestFrom')?.addEventListener('click', resetWithLatestFrom);


            // --- Section 6: Useful Operators ---
            const takeCountInputEl = document.getElementById('takeCountInput');
            const takeCountDisplayEl = document.getElementById('takeCountDisplay');
            const takeInputStreamEl = document.getElementById('takeInputStream');
            const takeOutputStreamEl = document.getElementById('takeOutputStream');
            
            function resetTakeOperator() {
                cleanupSub('take');
                clearStream(takeInputStreamEl, takeOutputStreamEl);
            }
            
            function runTakeOperator() {
                resetTakeOperator();
                const count = parseInt(takeCountInputEl.value) || 3;
                takeCountDisplayEl.textContent = count;
                
                const sub = interval(500).pipe(
                    tap(val => addMarble(takeInputStreamEl, val + 1, false)),
                    take(count),
                    map(i => i + 1)
                ).subscribe({
                    next: val => addMarble(takeOutputStreamEl, val, true),
                    complete: () => { 
                        addCompletionMarble(takeInputStreamEl, 100);
                        addCompletionMarble(takeOutputStreamEl, 100); 
                    }
                });
                manageSub('take', sub);
            }
            document.getElementById('runTakeOperator')?.addEventListener('click', runTakeOperator);
            document.getElementById('resetTakeOperator')?.addEventListener('click', resetTakeOperator);
            if (takeCountInputEl) takeCountInputEl.onchange = () => { if(takeCountDisplayEl) takeCountDisplayEl.textContent = takeCountInputEl.value; };
            
            const zipSource1StreamEl = document.getElementById('zipSource1Stream');
            const zipSource2StreamEl = document.getElementById('zipSource2Stream');
            const zipOutputStreamEl = document.getElementById('zipOutputStream');
            const zipLoggerOutputEl = document.getElementById('zipLoggerOutput');
            let zipSourceA_Subject, zipSourceB_Subject;
            
            function setupZip() {
                cleanupSub('zip');
                clearStream(zipSource1StreamEl, zipSource2StreamEl, zipOutputStreamEl);
                if(zipLoggerOutputEl) zipLoggerOutputEl.innerHTML = '';
                
                zipSourceA_Subject = new Subject(); 
                zipSourceB_Subject = new Subject();
                
                logTo(zipLoggerOutputEl, "Zip s·∫µn s√†ng. Ph√°t stream A (s·ªë) ho·∫∑c B (ch·ªØ).");
                
                const sub = zip(zipSourceA_Subject, zipSourceB_Subject).subscribe(([valA, valB]) => { 
                    addMarble(zipOutputStreamEl, [valA, valB], true, 0, '#E67E22'); 
                    logTo(zipLoggerOutputEl, `Observer Zip: [${valA}, ${valB}]`); 
                });
                manageSub('zip', sub);
            }
            
            let currentNumZip = 0; 
            document.getElementById('emitSource1Zip')?.addEventListener('click', () => { 
                if (!subscriptions.has('zip')) setupZip(); 
                currentNumZip++; 
                if (zipSourceA_Subject) zipSourceA_Subject.next(currentNumZip); 
                addMarble(zipSource1StreamEl, currentNumZip, false, 0, '#F1C40F'); 
                logTo(zipLoggerOutputEl, `Stream A ph√°t: ${currentNumZip}`);
            });
            
            let currentCharCodeZip = 64; 
            document.getElementById('emitSource2Zip')?.addEventListener('click', () => { 
                if (!subscriptions.has('zip')) setupZip(); 
                currentCharCodeZip++; 
                if (currentCharCodeZip > 90) currentCharCodeZip = 65; 
                const char = String.fromCharCode(currentCharCodeZip); 
                if (zipSourceB_Subject) zipSourceB_Subject.next(char); 
                addMarble(zipSource2StreamEl, char, false, 0, '#9B59B6'); 
                logTo(zipLoggerOutputEl, `Stream B ph√°t: ${char}`);
            });
            document.getElementById('resetZipOperator')?.addEventListener('click', () => { currentNumZip = 0; currentCharCodeZip = 64; setupZip(); });
            setupZip();
            
            const catchErrorInputStreamEl = document.getElementById('catchErrorInputStream');
            const catchErrorOutputStreamEl = document.getElementById('catchErrorOutputStream');
            function resetCatchError() {
                cleanupSub('catchError');
                clearStream(catchErrorInputStreamEl, catchErrorOutputStreamEl);
            }
            function setupCatchErrorDemo(willError) {
                resetCatchError();
                const source$ = new Observable(subscriber => {
                    addMarble(catchErrorInputStreamEl, 1, false, 0); 
                    subscriber.next(1);
                    setTimeout(() => {
                        addMarble(catchErrorInputStreamEl, 2, false, 200); 
                        subscriber.next(2);
                    }, 500);
                    setTimeout(() => {
                        if (willError) { 
                            addMarble(catchErrorInputStreamEl, new Error('B√ôM!'), false, 0); 
                            subscriber.error(new Error('B√ôM!')); 
                        } else { 
                            addMarble(catchErrorInputStreamEl, 3, false, 0); 
                            subscriber.next(3); 
                            subscriber.complete(); 
                        }
                    }, 1000);
                });
                
                const sub = source$.pipe(
                    catchError((err, caught) => { 
                        addMarble(catchErrorOutputStreamEl, 'FIXED!', true, 0, null, 'fallback'); 
                        return of('ƒê√£ Fix'); 
                    })
                ).subscribe({
                    next: val => addMarble(catchErrorOutputStreamEl, val, true, 0),
                    error: err => addMarble(catchErrorOutputStreamEl, new Error('L·ªói Cu·ªëi'), true, 0),
                    complete: () => addCompletionMarble(catchErrorOutputStreamEl, 100)
                });
                manageSub('catchError', sub);
            }
            document.getElementById('runCatchErrorStream')?.addEventListener('click', () => setupCatchErrorDemo(true));
            document.getElementById('runCatchErrorStreamNoError')?.addEventListener('click', () => setupCatchErrorDemo(false));
            document.getElementById('resetCatchError')?.addEventListener('click', resetCatchError);
            
            const startWithValuesInputEl = document.getElementById('startWithValuesInput');
            const startWithValuesDisplayEl = document.getElementById('startWithValuesDisplay');
            const startWithInputStreamEl = document.getElementById('startWithInputStream');
            const startWithOutputStreamEl = document.getElementById('startWithOutputStream');
            function resetStartWith() {
                cleanupSub('startWith');
                clearStream(startWithInputStreamEl, startWithOutputStreamEl);
            }
            function runStartWith() {
                resetStartWith();
                const rawValues = startWithValuesInputEl.value.split(',').map(s => s.trim()).filter(s => s !== '');
                const startValues = rawValues.map(s => isNaN(parseFloat(s)) || s.match(/[a-zA-Z]/) ? s : parseFloat(s));
                startWithValuesDisplayEl.textContent = startValues.join(',');
                
                const source$ = of(10, 20, 30).pipe(
                    concatMap(val => of(val).pipe(delay(300))),
                    tap(val => addMarble(startWithInputStreamEl, val, false, 0, '#FFC300'))
                );
                
                const sub = source$.pipe(
                    delay(1000), 
                    startWith(...startValues)
                ).subscribe({
                    next: val => addMarble(startWithOutputStreamEl, val, true, 0),
                    complete: () => { 
                        addCompletionMarble(startWithOutputStreamEl, 100); 
                        addCompletionMarble(startWithInputStreamEl, 100); 
                    }
                });
                manageSub('startWith', sub);
            }
            document.getElementById('runStartWithOperator')?.addEventListener('click', runStartWith);
            document.getElementById('resetStartWithOperator')?.addEventListener('click', resetStartWith);
            
            // --- Section 7: Subjects ---
            function setupSubjectDemo(name, runBtnId, emitBtnId, addSub2BtnId, resetBtnId, logElId, sub1OutElId, sub2OutElId, createSubjectFn) {
                const logEl = document.getElementById(logElId);
                const sub1OutEl = document.getElementById(sub1OutElId);
                const sub2OutEl = document.getElementById(sub2OutElId);
                let subject, sub1, sub2, counter = 0;
                
                function reset() {
                    if(sub1) sub1.unsubscribe(); 
                    if(sub2) sub2.unsubscribe();
                    if(subject) subject.complete();
                    clearStream(logEl, sub1OutEl, sub2OutEl);
                    counter = 0;
                    subject = sub1 = sub2 = null;
                     logTo(logEl, `${name} ƒë√£ reset.`);
                }

                document.getElementById(runBtnId)?.addEventListener('click', () => {
                    if (subject) return;
                    subject = createSubjectFn();
                    logTo(logEl, `T·∫°o ${name}. Sub1 ƒëƒÉng k√Ω.`);
                    sub1 = subject.subscribe(val => { 
                        addMarble(sub1OutEl, val, false, 0, '#9b59b6'); 
                        logTo(logEl, `Sub1 nh·∫≠n: ${val}`); 
                    });
                });

                document.getElementById(emitBtnId)?.addEventListener('click', () => {
                    if(!subject) { logTo(logEl, `T·∫°o ${name} tr∆∞·ªõc!`, true); return; } 
                    counter++; 
                    const val = (name === 'BehaviorSubject') ? `Value ${counter}` : counter;
                    logTo(logEl, `${name} ph√°t: ${val}`); 
                    subject.next(val); 
                });

                document.getElementById(addSub2BtnId)?.addEventListener('click', () => {
                    if(!subject) { logTo(logEl, `T·∫°o ${name} tr∆∞·ªõc!`, true); return; } 
                    if(sub2 && !sub2.closed) { logTo(logEl, "Sub2 ƒë√£ ƒëƒÉng k√Ω r·ªìi."); return; }
                    logTo(logEl, "Sub2 ƒëƒÉng k√Ω."); 
                    sub2 = subject.subscribe(val => { 
                        addMarble(sub2OutEl, val, false, 0, '#e67e22'); 
                        logTo(logEl, `Sub2 nh·∫≠n: ${val}`); 
                    }); 
                });
                
                document.getElementById(resetBtnId)?.addEventListener('click', reset);
            }
            
            setupSubjectDemo('Subject', 'runBasicSubject', 'emitToBasicSubject', 'addBasicSubjectSub2', 'resetBasicSubject', 'basicSubjectLog', 'basicSubjectSub1Output', 'basicSubjectSub2Output', () => new Subject());
            setupSubjectDemo('BehaviorSubject', 'runBehaviorSubject', 'emitToBehaviorSubject', 'addBehaviorSubjectSub2', 'resetBehaviorSubject', 'behaviorSubjectLog', 'behaviorSubjectSub1Output', 'behaviorSubjectSub2Output', () => new BehaviorSubject('Hi·∫øu'));
            setupSubjectDemo('ReplaySubject', 'runReplaySubject', 'emitToReplaySubject', 'addReplaySubjectSub2', 'resetReplaySubject', 'replaySubjectLog', 'replaySubjectSub1Output', 'replaySubjectSub2Output', () => new ReplaySubject(2));

            // --- Section 8: Real world examples ---
            const typeaheadInputEl = document.getElementById('typeaheadInput');
            if (typeaheadInputEl) {
                const inputStreamEl = document.getElementById('typeaheadInputStream');
                const resultEl = document.getElementById('typeaheadResult');
                const fakeApiSearch = (term) => timer(500).pipe(map(() => `K·∫øt qu·∫£ cho '${term}'`));
                
                const sub = fromEvent(typeaheadInputEl, 'input').pipe(
                    map(event => event.target.value),
                    tap(term => {
                        clearStream(inputStreamEl);
                        addMarble(inputStreamEl, term || 'tr·ªëng', false);
                    }),
                    debounceTime(400),
                    distinctUntilChanged(),
                    tap(() => resultEl.innerHTML = 'ƒêang t√¨m ki·∫øm...'),
                    switchMap(term => term ? fakeApiSearch(term) : of('G√µ ƒë·ªÉ t√¨m ki·∫øm'))
                ).subscribe(result => {
                    if (resultEl) resultEl.textContent = result;
                });
                manageSub('typeahead', sub);
            }
            
            const startProgressBarBtn = document.getElementById('startProgressBar');
            const progressFillEl = document.getElementById('progressFill');
            const progressStatusEl = document.getElementById('progressStatus');
            function resetProgressBar() {
                cleanupSub('progressBar');
                if (progressFillEl) progressFillEl.style.width = '0%';
                if (progressStatusEl) progressStatusEl.textContent = '';
                if (startProgressBarBtn) startProgressBarBtn.disabled = false;
            }
            function runProgressBar() {
                 resetProgressBar();
                 const sub = fromEvent(startProgressBarBtn, 'click').pipe(
                    exhaustMap(() => {
                        startProgressBarBtn.disabled = true;
                        progressStatusEl.textContent = "ƒêang t·∫£i...";
                        return interval(40).pipe(
                            take(101),
                            finalize(() => {
                                startProgressBarBtn.disabled = false;
                                progressStatusEl.textContent = 'Ho√†n th√†nh!';
                            })
                        );
                    })
                ).subscribe(percentage => {
                    progressFillEl.style.width = `${percentage}%`;
                    if(percentage < 100) {
                       progressStatusEl.textContent = `ƒêang t·∫£i... ${percentage}%`;
                    }
                });
                manageSub('progressBar', sub);
                startProgressBarBtn.click();
            }
            if (startProgressBarBtn) startProgressBarBtn.addEventListener('click', runProgressBar);
            document.getElementById('resetProgressBar')?.addEventListener('click', resetProgressBar);

            const usernameInput = document.getElementById('usernameInput');
            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.getElementById('submitFormBtn');
            const formStatus = document.getElementById('formStatus');

            if(usernameInput && emailInput && passwordInput && submitBtn) {
                const createValidationStream = (inputEl, validationFn) => fromEvent(inputEl, 'input').pipe(
                    map(event => event.target.value),
                    startWith(''),
                    debounceTime(500),
                    distinctUntilChanged(),
                    switchMap(validationFn),
                    shareReplay(1)
                );

                const isUsernameAvailable = (username) => timer(500).pipe(map(() => !['admin', 'root', 'test'].includes(username.toLowerCase())));

                const username$ = createValidationStream(usernameInput, value => {
                    if (value.length < 3) return of({ el: usernameInput, valid: false, msg: 'Ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±.' });
                    return isUsernameAvailable(value).pipe(
                        map(isAvailable => isAvailable 
                            ? { el: usernameInput, valid: true, msg: 'T√™n ng∆∞·ªùi d√πng h·ª£p l·ªá.' } 
                            : { el: usernameInput, valid: false, msg: 'T√™n ng∆∞·ªùi d√πng ƒë√£ t·ªìn t·∫°i.' }
                        )
                    );
                });
                
                const email$ = createValidationStream(emailInput, value => {
                    const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                    return of(
                        value === '' ? { el: emailInput, valid: false, msg: '' } :
                        isValid ? { el: emailInput, valid: true, msg: 'Email h·ª£p l·ªá.'} : { el: emailInput, valid: false, msg: 'Email kh√¥ng h·ª£p l·ªá.'}
                    );
                });

                const password$ = createValidationStream(passwordInput, value => {
                    const isValid = value.length >= 6;
                    return of(
                        value === '' ? { el: passwordInput, valid: false, msg: '' } :
                        isValid ? { el: passwordInput, valid: true, msg: 'M·∫≠t kh·∫©u m·∫°nh.'} : { el: passwordInput, valid: false, msg: 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.'}
                    );
                });

                const validationSubscriber = (stream$, key) => {
                    const sub = stream$.subscribe(({el, valid, msg}) => {
                        const msgEl = document.getElementById(`${el.id}ValidationMsg`);
                        el.classList.toggle('is-valid', valid);
                        el.classList.toggle('is-invalid', !valid && msg !== '');
                        if (msgEl) msgEl.textContent = msg;
                        if (msgEl) msgEl.className = `validation-message ${valid ? 'is-valid' : 'is-invalid'}`;
                    });
                    manageSub(key, sub);
                };

                validationSubscriber(username$, 'validationUser');
                validationSubscriber(email$, 'validationEmail');
                validationSubscriber(password$, 'validationPass');
                
                const formValid$ = combineLatest([username$, email$, password$]).pipe(
                    map(([user, email, pass]) => user.valid && email.valid && pass.valid)
                );
                
                const formSub = formValid$.subscribe(isValid => {
                    submitBtn.disabled = !isValid;
                    formStatus.textContent = isValid ? 'Bi·ªÉu m·∫´u h·ª£p l·ªá!' : 'Vui l√≤ng ƒëi·ªÅn ƒë√∫ng th√¥ng tin.';
                    formStatus.classList.toggle('text-green-600', isValid);
                    formStatus.classList.toggle('text-red-600', !isValid);
                });
                manageSub('formValidation', formSub);
            }

            // --- Section 9: Hardcore Examples ---
            const advancedSearchInputEl = document.getElementById('advancedSearchInput');
            if (advancedSearchInputEl) {
                const advancedSearchOuterStreamEl = document.getElementById('advancedSearchOuterStream');
                const advancedSearchResultStreamEl = document.getElementById('advancedSearchResultStream');
                const advancedSearchLoggerEl = document.getElementById('advancedSearchLogger');
                
                const fakeApiCallAdv = (query) => timer(1000).pipe(map(() => { 
                    if (query.toLowerCase() === 'error') throw new Error('API c·ªë t√¨nh l·ªói!'); 
                    return `K·∫øt qu·∫£ cho '${query}'`; 
                }));
                
                const sub = fromEvent(advancedSearchInputEl, 'input').pipe(
                    map(event => event.target.value),
                    tap(query => { 
                        clearStream(advancedSearchOuterStreamEl); 
                        addMarble(advancedSearchOuterStreamEl, query || "tr·ªëng", false, 0, '#bdc3c7'); 
                    }),
                    debounceTime(500), 
                    distinctUntilChanged(),
                    switchMap(query => {
                        if (!query.trim()) { 
                            clearStream(advancedSearchResultStreamEl); 
                            logTo(advancedSearchLoggerEl, 'Input tr·ªëng, ƒë√£ clear.');
                            return EMPTY; 
                        }
                        logTo(advancedSearchLoggerEl, `T√¨m ki·∫øm: "${query}"`);
                        return fakeApiCallAdv(query).pipe(
                            startWith('ƒêang t·∫£i...'), 
                            catchError(err => of(new Error(`L·ªói: ${err.message}`)))
                        );
                    })
                ).subscribe(result => {
                    clearStream(advancedSearchResultStreamEl); 
                    addMarble(advancedSearchResultStreamEl, result, true, 0); 
                    logTo(advancedSearchLoggerEl, `Hi·ªÉn th·ªã: ${result.message || result}`);
                });
                manageSub('advancedSearch', sub);
            }
            
            const draggableBoxEl = document.getElementById('draggableBox');
            const dropZoneEl = document.getElementById('dropZone');
            const dragDropLoggerEl = document.getElementById('dragDropLogger');
            
            if (draggableBoxEl && dropZoneEl && dragDropLoggerEl) {
                function resetDragDrop() {
                    cleanupSub('dragdrop');
                    clearStream(dragDropLoggerEl);
                    draggableBoxEl.style.left = '20px';
                    draggableBoxEl.style.top = '20px';
                    dropZoneEl.textContent = 'Th·∫£ v√†o ƒë√¢y!';
                    dropZoneEl.classList.remove('over');
                }
                document.getElementById('resetDragDrop')?.addEventListener('click', resetDragDrop);

                const mouseDown$ = fromEvent(draggableBoxEl, 'mousedown');
                const mouseMove$ = fromEvent(document, 'mousemove');
                const mouseUp$ = fromEvent(document, 'mouseup');
                
                const sub = mouseDown$.pipe(
                    tap(e => e.preventDefault()),
                    exhaustMap(downEvent => {
                        draggableBoxEl.classList.add('dragging');
                        logTo(dragDropLoggerEl, 'B·∫Øt ƒë·∫ßu k√©o...');
                        const startX = draggableBoxEl.offsetLeft;
                        const startY = draggableBoxEl.offsetTop;
                        const mouseStartX = downEvent.clientX;
                        const mouseStartY = downEvent.clientY;
                        
                        return mouseMove$.pipe(
                            map(moveEvent => ({
                                x: startX + (moveEvent.clientX - mouseStartX),
                                y: startY + (moveEvent.clientY - mouseStartY)
                            })),
                            takeUntil(mouseUp$.pipe(tap(() => {
                                draggableBoxEl.classList.remove('dragging');
                                logTo(dragDropLoggerEl, 'K·∫øt th√∫c k√©o!');
                                const rB = draggableBoxEl.getBoundingClientRect();
                                const rZ = dropZoneEl.getBoundingClientRect();
                                const isOver = !(rB.right < rZ.left || rB.left > rZ.right || rB.bottom < rZ.top || rB.top > rZ.bottom);
                                if(isOver) { 
                                    logTo(dragDropLoggerEl, 'Th·∫£ th√†nh c√¥ng!');
                                    dropZoneEl.classList.add('over');
                                    createConfetti(); 
                                    setTimeout(() => dropZoneEl.classList.remove('over'), 1500);
                                }
                            })))
                        );
                    })
                ).subscribe(pos => {
                    draggableBoxEl.style.left = `${pos.x}px`;
                    draggableBoxEl.style.top = `${pos.y}px`;
                });
                manageSub('dragdrop', sub);
            }
            
            const pollingStatusEl = document.getElementById('pollingStatus');
            const pollingDataStreamEl = document.getElementById('pollingDataStream');
            const pollingLoggerEl = document.getElementById('pollingLogger');
            
            if (pollingStatusEl) {
                const startPoll$ = fromEvent(document.getElementById('startPollingBtn'), 'click');
                const stopPoll$ = fromEvent(document.getElementById('stopPollingBtn'), 'click');
                const fetchData = () => timer(500).pipe(map(() => `Data ${new Date().toLocaleTimeString()}`));
                
                const sub = startPoll$.pipe(
                    switchMap(() => {
                        pollingStatusEl.textContent = "Tr·∫°ng th√°i: ƒêang ch·∫°y...";
                        logTo(pollingLoggerEl, "--- B·∫Øt ƒë·∫ßu Poll ---");
                        clearStream(pollingDataStreamEl);
                        return timer(0, 3000).pipe(
                            tap(() => logTo(pollingLoggerEl, 'Timer ph√°t...')),
                            switchMap(fetchData),
                            takeUntil(stopPoll$.pipe(tap(() => { 
                                pollingStatusEl.textContent = "Tr·∫°ng th√°i: ƒê√£ d·ª´ng"; 
                                logTo(pollingLoggerEl, "--- D·ª´ng Poll ---");
                            })))
                        );
                    })
                ).subscribe(data => { 
                    addMarble(pollingDataStreamEl, data, true, 0, '#27ae60'); 
                });
                manageSub('polling', sub);
            }
            
            // --- 10.1 Multi-API Search ---
            const multiApiSearchInputEl = document.getElementById('multiApiSearchInput');
            if (multiApiSearchInputEl) {
                const fakeApiMulti1 = (q) => timer(600).pipe(map(() => [`API1:${q}-A`, `API1:${q}-B`]));
                const fakeApiMulti2 = (q) => timer(1000).pipe(map(() => [`API2:${q}-X`, `API2:${q}-Y`]));
                
                const sub = fromEvent(multiApiSearchInputEl, 'input').pipe(
                    map(event => event.target.value),
                    tap(q => {
                        clearStream(document.getElementById('multiApiSearchOuterStream'));
                        addMarble(document.getElementById('multiApiSearchOuterStream'), q || "tr·ªëng", false);
                    }),
                    debounceTime(700),
                    distinctUntilChanged(),
                    filter(q => q.length > 1),
                    tap(() => {
                        clearStream(document.getElementById('multiApi1ResultStream'), document.getElementById('multiApi2ResultStream'), document.getElementById('multiApiCombinedResultStream'));
                        addMarble(document.getElementById('multiApiCombinedResultStream'), 'ƒêang t·∫£i...', false, 0, null, 'loading');
                    }),
                    switchMap(q => forkJoin([
                        fakeApiMulti1(q).pipe(tap(res => { clearStream(document.getElementById('multiApi1ResultStream')); res.forEach(r => addMarble(document.getElementById('multiApi1ResultStream'), r, false, 0, null, 'api1')); })),
                        fakeApiMulti2(q).pipe(tap(res => { clearStream(document.getElementById('multiApi2ResultStream')); res.forEach(r => addMarble(document.getElementById('multiApi2ResultStream'), r, false, 0, null, 'api2')); }))
                    ]).pipe(map(res => res.flat()), catchError(() => of(['L·ªói API']))))
                ).subscribe(results => {
                    clearStream(document.getElementById('multiApiCombinedResultStream'));
                    results.forEach(r => addMarble(document.getElementById('multiApiCombinedResultStream'), r, true, 0));
                });
                manageSub('multiApi', sub);
            }

            // --- 10.2 Sequential Tasks ---
            const startSequentialTasksBtn = document.getElementById('startSequentialTasksBtn');
            const sequentialTasksProgressEl = document.getElementById('sequentialTasksProgressStream');
            const sequentialTasksLoggerEl = document.getElementById('sequentialTasksLogger');

            function resetSequentialTasks() {
                cleanupSub('sequential');
                if(startSequentialTasksBtn) startSequentialTasksBtn.disabled = false;
                clearStream(sequentialTasksProgressEl, sequentialTasksLoggerEl);
            }
            function runSequentialTasks() {
                resetSequentialTasks();
                if(startSequentialTasksBtn) startSequentialTasksBtn.disabled = true;
                logTo(sequentialTasksLoggerEl, '--- B·∫Øt ƒë·∫ßu chu·ªói t√°c v·ª• ---');
                let task2Attempt = 0;
                const task1$ = of('1. X√°c th·ª±c').pipe(delay(800), tap(msg => addMarble(sequentialTasksProgressEl, `‚úÖ User`, true, 0, '#2ecc71')));
                const task2$ = defer(() => {
                    task2Attempt++;
                    addMarble(sequentialTasksProgressEl, `API #${task2Attempt}`, false, 0, '#f1c40f');
                    if (task2Attempt <= 1) return timer(1000).pipe(mergeMap(() => throwError(() => new Error('M·∫°ng y·∫øu'))));
                    return timer(1000).pipe(map(() => '2. L·∫•y d·ªØ li·ªáu OK'));
                }).pipe(retry(1), tap(() => addMarble(sequentialTasksProgressEl, `‚úÖ Data`, true, 0, '#2ecc71')), catchError(() => {
                    addMarble(sequentialTasksProgressEl, '‚ùå Data', true, 0, null, 'error');
                    return of('L·ªói');
                }));
                const task3$ = of('3. Hi·ªÉn th·ªã').pipe(delay(600), tap(() => addMarble(sequentialTasksProgressEl, `‚úÖ UI`, true, 0, '#2ecc71')));

                const sub = concat(task1$, task2$, task3$).pipe(
                    finalize(() => {
                        addCompletionMarble(sequentialTasksProgressEl, 100);
                        if(startSequentialTasksBtn) startSequentialTasksBtn.disabled = false;
                    })
                ).subscribe();
                manageSub('sequential', sub);
            }
            startSequentialTasksBtn?.addEventListener('click', runSequentialTasks);
            document.getElementById('resetSequentialTasksBtn')?.addEventListener('click', resetSequentialTasks);

            // --- 10.3 Infinite Scroll ---
            const infiniteScrollContainerEl = document.getElementById('infiniteScrollContainer');
            const infiniteScrollLoggerEl = document.getElementById('infiniteScrollLogger');
            let infiniteScrollPage = 0;
            let infiniteScrollLoading = false;
            
            function fetchItemsForScroll(pageNum) {
                infiniteScrollLoading = true;
                logTo(infiniteScrollLoggerEl, `ƒêang t·∫£i trang ${pageNum}...`);
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'loading-more';
                loadingDiv.textContent = 'ƒêang t·∫£i th√™m...';
                infiniteScrollContainerEl.appendChild(loadingDiv);
                
                return timer(1000).pipe(
                    map(() => Array.from({length: 7}, (_, i) => `Item ${pageNum * 7 + i + 1}`)),
                    finalize(() => { 
                        infiniteScrollLoading = false; 
                        const el = infiniteScrollContainerEl.querySelector('.loading-more');
                        if (el) el.remove();
                        logTo(infiniteScrollLoggerEl, `T·∫£i xong trang ${pageNum}.`);
                    })
                );
            }

            function loadInitialScrollItems() {
                const sub = fetchItemsForScroll(infiniteScrollPage).subscribe(items => {
                    items.forEach(itemText => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item';
                        itemDiv.textContent = itemText;
                        infiniteScrollContainerEl.appendChild(itemDiv);
                    });
                });
                manageSub('infiniteScrollInitial', sub);
            }
            
            function resetInfiniteScroll() {
                cleanupSub('infiniteScroll');
                cleanupSub('infiniteScrollInitial');
                infiniteScrollPage = 0;
                infiniteScrollLoading = false;
                clearStream(infiniteScrollContainerEl, infiniteScrollLoggerEl);
                loadInitialScrollItems();
            }
            document.getElementById('resetInfiniteScrollBtn')?.addEventListener('click', resetInfiniteScroll);
            
            if (infiniteScrollContainerEl) {
                loadInitialScrollItems();
                const sub = fromEvent(infiniteScrollContainerEl, 'scroll').pipe(
                    filter(() => !infiniteScrollLoading && (infiniteScrollContainerEl.scrollTop + infiniteScrollContainerEl.clientHeight >= infiniteScrollContainerEl.scrollHeight - 100)),
                    debounceTime(200),
                    exhaustMap(() => {
                        infiniteScrollPage++;
                        return fetchItemsForScroll(infiniteScrollPage);
                    })
                ).subscribe(newItems => {
                    newItems.forEach(itemText => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'item';
                        itemDiv.textContent = itemText;
                        infiniteScrollContainerEl.appendChild(itemDiv);
                    });
                });
                manageSub('infiniteScroll', sub);
            }
            
            // --- Initialize first section ---
            document.querySelector('.nav-button[data-section="intro"]')?.click();
        });
    </script>
</body>
</html>
